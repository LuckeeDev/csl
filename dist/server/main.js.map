{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///external \"tslib\"","webpack:///./apps/server/src/app/config/authcheck.ts","webpack:///external \"mongoose\"","webpack:///external \"express\"","webpack:///external \"path\"","webpack:///./apps/server/src/app/controllers/classe.ts","webpack:///./apps/server/src/app/controllers/user.ts","webpack:///./apps/server/src/app/config/winston.ts","webpack:///./apps/server/src/environments/environment.prod.ts","webpack:///external \"fs-extra\"","webpack:///./apps/server/src/app/config/firebase.ts","webpack:///external \"os\"","webpack:///external \"passport\"","webpack:///./apps/server/src/app/controllers/product.ts","webpack:///./apps/server/src/app/controllers/snack.ts","webpack:///./apps/server/src/app/controllers/order.ts","webpack:///./apps/server/src/app/controllers/snack-order.ts","webpack:///external \"stripe\"","webpack:///./apps/server/src/app/controllers/article.ts","webpack:///./apps/server/src/app/controllers/commissione.ts","webpack:///external \"sharp\"","webpack:///external \"uuid\"","webpack:///external \"firebase-admin\"","webpack:///./apps/server/src/app/controllers/report.ts","webpack:///external \"winston\"","webpack:///external \"winston-mongodb\"","webpack:///./apps/server/src/app/controllers/log.ts","webpack:///./apps/server/src/app/controllers/course.ts","webpack:///external \"dotenv\"","webpack:///external \"cors\"","webpack:///external \"express-fileupload\"","webpack:///external \"cookie-session\"","webpack:///./apps/server/src/app/config/webhook.ts","webpack:///external \"http\"","webpack:///external \"socket.io\"","webpack:///./apps/server/src/app/config/socket.ts","webpack:///./apps/server/src/app/routes/admin.ts","webpack:///./apps/server/src/app/routes/auth.ts","webpack:///./apps/server/src/app/config/login.ts","webpack:///./apps/server/src/app/routes/upload.ts","webpack:///./apps/server/src/app/config/csvupload.ts","webpack:///external \"csvtojson\"","webpack:///./apps/server/src/app/routes/users.ts","webpack:///./apps/server/src/app/routes/articles.ts","webpack:///./apps/server/src/app/routes/products.ts","webpack:///./apps/server/src/app/routes/orders.ts","webpack:///./apps/server/src/app/routes/reports.ts","webpack:///./apps/server/src/app/routes/snacks.ts","webpack:///./apps/server/src/app/routes/coge.ts","webpack:///./apps/server/src/app/routes/commissioni.ts","webpack:///./apps/server/src/main.ts","webpack:///./apps/server/src/app/config/passport.ts","webpack:///external \"passport-google-oauth\""],"names":[],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 50);\n","module.exports = require(\"tslib\");","import { Response, NextFunction } from 'express';\r\nimport { ICommissione, IRequest } from '@csl/shared';\r\n\r\nfunction unauthorized(res: Response) {\r\n  res.status(403).end();\r\n}\r\n\r\n// Checks if a user is admin\r\nexport const isAdmin = (req: IRequest, res: Response, next: NextFunction) => {\r\n  if (req.user && req.user.isAdmin) {\r\n    next();\r\n  } else {\r\n    unauthorized(res);\r\n  }\r\n};\r\n\r\n// Checks if a user is either vice, rappre or bar\r\nexport const isPowerful = (\r\n  req: IRequest,\r\n  res: Response,\r\n  next: NextFunction\r\n) => {\r\n  if (req.user && (req.user.isVice || req.user.isRappre || req.user.isBar)) {\r\n    next();\r\n  } else {\r\n    unauthorized(res);\r\n  }\r\n};\r\n\r\n// Checks if a user is Vice\r\nexport const isVice = (req: IRequest, res: Response, next: NextFunction) => {\r\n  if (req.user && req.user.isVice) {\r\n    next();\r\n  } else {\r\n    unauthorized(res);\r\n  }\r\n};\r\n\r\n// Checks if a user is rappre\r\nexport const isRappre = (req: IRequest, res: Response, next: NextFunction) => {\r\n  if (req.user && req.user.isRappre) {\r\n    next();\r\n  } else {\r\n    unauthorized(res);\r\n  }\r\n};\r\n\r\n// Checks if a user is Qp\r\nexport const isQp = (req: IRequest, res: Response, next: NextFunction) => {\r\n  if (req.user && req.user.isQp) {\r\n    next();\r\n  } else {\r\n    unauthorized(res);\r\n  }\r\n};\r\n\r\n// Checks if a user is the bar admin\r\nexport const isBar = (req: IRequest, res: Response, next: NextFunction) => {\r\n  if (req.user && req.user.isBar) {\r\n    next();\r\n  } else {\r\n    unauthorized(res);\r\n  }\r\n};\r\n\r\n// Checks if a user is a Rappre di Classe\r\nexport const isRappreDiClasse = (\r\n  req: IRequest,\r\n  res: Response,\r\n  next: NextFunction\r\n) => {\r\n  if (req.user && req.user.isRappreDiClasse) {\r\n    next();\r\n  } else {\r\n    unauthorized(res);\r\n  }\r\n};\r\n\r\n// Checks if a user isReferente of the referred commissione\r\nexport const isReferente = (\r\n  req: IRequest,\r\n  res: Response,\r\n  next: NextFunction\r\n) => {\r\n  const params: any = req.params;\r\n  const commissione: ICommissione['id'] = params.id;\r\n\r\n  if (\r\n    req.user &&\r\n    ((commissione === 'comitato' && req.user.isRappre) ||\r\n      req.user.isReferente === commissione)\r\n  ) {\r\n    next();\r\n  } else {\r\n    unauthorized(res);\r\n  }\r\n};\r\n\r\n// Checks if a user is logged in and, if not, sends unauthorized response\r\nexport const authCheck = (req: IRequest, res: Response, next: NextFunction) => {\r\n  if (req.user) {\r\n    next();\r\n  } else {\r\n    unauthorized(res);\r\n  }\r\n};\r\n\r\n// Checks if a user is logged in and, if not, sends a null response\r\nexport const profileCheck = (\r\n  req: IRequest,\r\n  res: Response,\r\n  next: NextFunction\r\n) => {\r\n  if (req.user) {\r\n    next();\r\n  } else {\r\n    res.send(null);\r\n  }\r\n};\r\n\r\n// Checks if a user is not yet logged in\r\nexport const notAuthCheck = (\r\n  req: IRequest,\r\n  res: Response,\r\n  next: NextFunction\r\n) => {\r\n  if (req.user) {\r\n    res.redirect('../dashboard');\r\n  } else {\r\n    next();\r\n  }\r\n};\r\n","module.exports = require(\"mongoose\");","module.exports = require(\"express\");","module.exports = require(\"path\");","import mongoose, { Schema } from 'mongoose';\r\nimport { Order } from '@controllers/order';\r\nimport { IClass, IClassModel, IUser, IProduct } from '@csl/shared';\r\n\r\nconst ClassSchema = new Schema(\r\n  {\r\n    id: { type: String, required: true, unique: true },\r\n    members: { type: Array, required: true },\r\n    membersCount: { type: Number, required: true },\r\n    gadgetTotal: { type: Number, required: true, default: 0 },\r\n    gadgetPaid: { type: Boolean, required: true, default: false },\r\n    photoTotal: { type: Number, required: true, default: 0 },\r\n    photoPaid: { type: Boolean, required: true, default: false },\r\n  },\r\n  { skipVersioning: true }\r\n);\r\n\r\nexport const Class = mongoose.model<IClassModel>('class', ClassSchema, 'classi');\r\n\r\n// Get all classes in the database\r\nexport const getClasses: any = async () => {\r\n  const res = await Class.find();\r\n\r\n  return res;\r\n};\r\n\r\n// Update the gadget total\r\nexport const updateTotal = async (\r\n  orderTotal: number,\r\n  classTotal: number,\r\n  category: IProduct['category'],\r\n  id: IClass['id']\r\n) => {\r\n  const totalToUpdate = category === 'gadgets' ? 'gadgetTotal' : 'photoTotal';\r\n\r\n  return Class.findOneAndUpdate(\r\n    { id },\r\n    { [totalToUpdate]: classTotal + orderTotal }\r\n  )\r\n    .then((res: any) => {\r\n      return {\r\n        success: true,\r\n        msg: 'Order confirmed',\r\n      };\r\n    })\r\n    .catch((err: any) => {\r\n      return {\r\n        success: false,\r\n        err,\r\n      };\r\n    });\r\n};\r\n\r\n// Get total of a specific class in a specific category\r\nexport const getTotal = async (\r\n  classID: IUser['classID'],\r\n  category: IProduct['category']\r\n) => {\r\n  const categoryTotal = category === 'gadgets' ? 'gadgetTotal' : 'photoTotal';\r\n\r\n  return Class.findOne({ id: classID }).then((res: any) => {\r\n    return res[categoryTotal];\r\n  });\r\n};\r\n\r\n// Set category total as paid\r\nexport const setPaid = async (\r\n  classID: IClass['id'],\r\n  category: IProduct['category']\r\n) => {\r\n  const categoryToUpdate = category === 'gadgets' ? 'gadgetPaid' : 'photoPaid';\r\n\r\n  await Class.findOneAndUpdate(\r\n    { id: classID },\r\n    { [categoryToUpdate]: true }\r\n  ).then();\r\n};\r\n\r\n// Verify that all class members have confirmed their order\r\nexport const verifyReady = async (\r\n  classID: IClass['id'],\r\n  category: IProduct['category']\r\n) => {\r\n  const confirmedCategory =\r\n    category === 'gadgets' ? 'gadgetsConfirmed' : 'photosConfirmed';\r\n\r\n  return await Order.find({ classID }).then((res: any) => {\r\n    const isNotConfirmed = res.find(\r\n      (obj: any) => obj[confirmedCategory] === false\r\n    );\r\n    // const result = !isNotConfirmed;\r\n\r\n    return !isNotConfirmed;\r\n  });\r\n};\r\n\r\n// Verify that the class hasn't already paid\r\nexport const verifyPaid = async (\r\n  id: IClass['id'],\r\n  category: IProduct['category']\r\n) => {\r\n  const paidCategory = category === 'gadgets' ? 'gadgetPaid' : 'photoPaid';\r\n\r\n  return await Class.findOne({ id }).then((res: any) => {\r\n    return res[paidCategory];\r\n  });\r\n};\r\n\r\nexport const updateSnackCreditInClass = async (\r\n  email: IUser['email'],\r\n  snackCredit: IUser['snackCredit'],\r\n  classID: IUser['classID']\r\n) => {\r\n  await Class.findOne({ id: classID }).then(async (classe) => {\r\n    const member = classe!.members.find((x) => x.email === email);\r\n\r\n    await Class.updateOne(\r\n      { id: classID, members: member },\r\n      {\r\n        $set: {\r\n          'members.$': {\r\n            email,\r\n            snackCredit,\r\n          },\r\n        },\r\n      }\r\n    ).then();\r\n  });\r\n};\r\n","import mongoose, { Schema } from 'mongoose';\r\nimport { TRole, IUser, IUserModel, IHttpRes, IAccount } from '@csl/shared';\r\n\r\n// Stripe initialization\r\nimport { environment as env } from '@environments/environment';\r\nimport Stripe from 'stripe';\r\nimport { Class, updateSnackCreditInClass } from '@controllers/classe';\r\nimport { saveError, saveEvent } from '@config/winston';\r\nconst stripe = new Stripe(env.STRIPE_KEY, {\r\n  apiVersion: '2020-08-27',\r\n  typescript: true,\r\n});\r\n\r\nconst UserSchema = new Schema(\r\n  {\r\n    id: { type: String },\r\n    email: { type: String, required: true, unique: true },\r\n    firstName: { type: String, required: true },\r\n    lastName: { type: String, required: true },\r\n    classID: { type: String },\r\n    snackCredit: { type: Number, default: 0 },\r\n    photoURL: { type: String },\r\n    stripeID: { type: String },\r\n    isVice: { type: Boolean },\r\n    isRappre: { type: Boolean },\r\n    isQp: { type: Boolean },\r\n    isRappreDiClasse: { type: Boolean },\r\n    isBar: { type: Boolean },\r\n    isAdmin: { type: Boolean },\r\n\r\n    isReferente: { type: String },\r\n  },\r\n  { skipVersioning: true }\r\n);\r\n\r\nexport const User = mongoose.model<IUserModel>('user', UserSchema);\r\n\r\n// Create an account (for admin)\r\nexport const createAccount = async (\r\n  account: IAccount,\r\n  user: IUser\r\n): Promise<IHttpRes<any>> => {\r\n  try {\r\n    await User.findOne({ email: account.email }).then((user) => {\r\n      if (!user) {\r\n        return new User(account).save().then();\r\n      }\r\n    })\r\n\r\n    await Class.findOne({ id: account.classID }).then((classe) => {\r\n      if (classe) {\r\n        return classe\r\n          .updateOne({\r\n            $push: {\r\n              members: { email: account.email, snackCredit: 0, roles: [] },\r\n            },\r\n          })\r\n          .then();\r\n      } else {\r\n        new Class({\r\n          id: account.classID,\r\n          members: [{ email: account.email, snackCredit: 0, roles: [] }],\r\n          membersCount: 1,\r\n        })\r\n          .save()\r\n          .then();\r\n      }\r\n    });\r\n\r\n    saveEvent(\r\n      `Manually created an account for ${account.firstName} ${account.lastName}`,\r\n      {\r\n        category: 'accounts',\r\n        user: user.email,\r\n      }\r\n    );\r\n\r\n    return {\r\n      success: true,\r\n    };\r\n  } catch (err) {\r\n    saveError(\r\n      `Error during the manual creation of an account for ${account.firstName} ${account.lastName}`,\r\n      {\r\n        category: 'accounts',\r\n        user: user.email,\r\n        err,\r\n      }\r\n    );\r\n  }\r\n};\r\n\r\n// Remove an account (for admin)\r\nexport const removeAccount = async (\r\n  email: IUser['email']\r\n): Promise<IHttpRes<any>> => {\r\n  const user = await User.findOneAndDelete({ email }).then();\r\n\r\n  const classe = await Class.findOne({ id: user.classID });\r\n\r\n  const elementToPull = classe.members.find((x) => x.email === email);\r\n\r\n  return Class.findOneAndUpdate(\r\n    { id: user.classID },\r\n    {\r\n      $pull: {\r\n        members: elementToPull,\r\n      },\r\n      $inc: {\r\n        membersCount: -1,\r\n      },\r\n    }\r\n  )\r\n    .then(() => {\r\n      return {\r\n        success: true,\r\n      };\r\n    })\r\n    .catch((err) => {\r\n      return {\r\n        success: false,\r\n        err,\r\n      };\r\n    });\r\n};\r\n\r\n// Add a role to a user\r\nexport const addRole = async (email: IUser['email'], role: TRole) => {\r\n  let updateQuery: { [key: string]: boolean | string };\r\n\r\n  if (role.includes('isReferente')) {\r\n    const regExp = /\\[([^)]+)\\]/;\r\n    const commissione = regExp.exec(role)[1];\r\n\r\n    updateQuery = { isReferente: commissione };\r\n  } else {\r\n    updateQuery = { [role]: true };\r\n  }\r\n\r\n  try {\r\n    const classID = await User.findOneAndUpdate({ email }, updateQuery).then(\r\n      (user) => user.classID\r\n    );\r\n\r\n    return Class.findOne({ id: classID }).then(async (classe) => {\r\n      const member = classe.members.find((x) => x.email === email);\r\n\r\n      member.roles.push(role);\r\n\r\n      try {\r\n        await Class.findOneAndUpdate(\r\n          { id: classID, members: { $elemMatch: { email } } },\r\n          { 'members.$': member }\r\n        );\r\n\r\n        return {\r\n          success: true,\r\n        };\r\n      } catch (err) {\r\n        return {\r\n          success: false,\r\n          err,\r\n        };\r\n      }\r\n    });\r\n  } catch (err) {\r\n    return {\r\n      success: false,\r\n      err,\r\n    };\r\n  }\r\n};\r\n\r\n// Remove a role from a user\r\nexport const removeRole = async (email: IUser['email'], role: TRole) => {\r\n  let updateClassQuery: any;\r\n\r\n  if (role.includes('isReferente')) {\r\n    const regExp = /\\[([^)]+)\\]/;\r\n    const commissione = regExp.exec(role)[1];\r\n\r\n    updateClassQuery = { isReferente: commissione };\r\n  } else {\r\n    updateClassQuery = { [role]: true };\r\n  }\r\n\r\n  const classID = await User.findOneAndUpdate(\r\n    { email: email },\r\n    { $unset: updateClassQuery }\r\n  ).then((user) => {\r\n    return user!.classID;\r\n  });\r\n\r\n  return Class.findOne({ id: classID }).then((classe) => {\r\n    const member = classe.members.find((x) => x.email === email);\r\n\r\n    const i = member.roles.findIndex((x) => x === role);\r\n\r\n    member.roles.splice(i, 1);\r\n\r\n    return Class.findOneAndUpdate(\r\n      { id: classID, members: { $elemMatch: { email } } },\r\n      { 'members.$': member }\r\n    )\r\n      .then((res) => {\r\n        return {\r\n          success: true,\r\n        };\r\n      })\r\n      .catch((err) => {\r\n        return {\r\n          success: false,\r\n          err,\r\n        };\r\n      });\r\n  });\r\n};\r\n\r\n// Get roles of a user\r\nexport const getRoles = (email: any) => {\r\n  return User.findOne({ email: email }).then((user: any) => {\r\n    const roles = [];\r\n    if (user.isVice) {\r\n      roles.push('isVice');\r\n    }\r\n    if (user.isRappre) {\r\n      roles.push('isRappre');\r\n    }\r\n    if (user.isRappreDiClasse) {\r\n      roles.push('isRappreDiClasse');\r\n    }\r\n    if (user.isQp) {\r\n      roles.push('isQp');\r\n    }\r\n    return roles;\r\n  });\r\n};\r\n\r\n// Get the stripe customer ID of a user\r\nexport const getStripeID = async (\r\n  id: IUser['id']\r\n): Promise<string | undefined> => {\r\n  const stripeID = await User.findOne({ id }).then((user) => {\r\n    if (user && user.isRappreDiClasse && user.stripeID) {\r\n      return user.stripeID;\r\n    } else if (user) {\r\n      return stripe.customers\r\n        .create({\r\n          name: `${user.firstName} ${user.lastName}`,\r\n          email: `${user.email}`,\r\n          description: `Rappresentante della ${user.classID}`,\r\n        })\r\n        .then(async (customer) => {\r\n          const newID = await User.findOneAndUpdate(\r\n            { id },\r\n            { stripeID: customer.id }\r\n          ).then((res: any) => {\r\n            return customer.id;\r\n          });\r\n\r\n          return newID;\r\n        });\r\n    }\r\n  });\r\n\r\n  return stripeID;\r\n};\r\n\r\n// Update credit (for bar)\r\nexport const updateCredit = async (\r\n  email: IUser['email'],\r\n  money: IUser['snackCredit']\r\n) => {\r\n  const result = await User.findOne({ email })\r\n    .then(async (user) => {\r\n      const snackCredit = money + user!.snackCredit;\r\n      const classID = user!.classID;\r\n\r\n      await updateSnackCreditInClass(email, snackCredit, classID);\r\n\r\n      return await User.findOneAndUpdate({ email }, { snackCredit })\r\n        .then((res) => {\r\n          return {\r\n            success: true,\r\n          };\r\n        })\r\n        .catch((err) => {\r\n          return {\r\n            success: false,\r\n            err,\r\n          };\r\n        });\r\n    })\r\n    .catch((err) => {\r\n      return {\r\n        success: false,\r\n        err,\r\n      };\r\n    });\r\n\r\n  return result;\r\n};\r\n","import winston from 'winston';\r\nimport { MongoDB } from 'winston-mongodb';\r\nimport { environment as env } from '@environments/environment';\r\nimport { ILogMetadata } from '@csl/shared';\r\n\r\nconst eventLogger = winston.createLogger({\r\n  transports: [\r\n    new MongoDB({\r\n      level: 'info',\r\n      db: env.DB_URI,\r\n      options: {\r\n        useNewUrlParser: true,\r\n        useUnifiedTopology: true,\r\n      },\r\n      collection: 'events',\r\n      name: 'info-transport',\r\n      tryReconnect: true,\r\n    }),\r\n  ],\r\n});\r\n\r\nexport const saveEvent = (msg: string, metadata: ILogMetadata) => {\r\n  eventLogger.log('info', msg, { metadata });\r\n};\r\n\r\nconst errorLogger = winston.createLogger({\r\n  transports: [\r\n    new MongoDB({\r\n      level: 'error',\r\n      db: env.DB_URI,\r\n      options: {\r\n        useNewUrlParser: true,\r\n        useUnifiedTopology: true,\r\n      },\r\n      collection: 'errors',\r\n      name: 'errors-transport',\r\n      tryReconnect: true,\r\n    }),\r\n  ],\r\n});\r\n\r\nexport const saveError = (msg: string, metadata: ILogMetadata) => {\r\n  errorLogger.log('error', msg, { metadata });\r\n};\r\n","import * as dotenv from 'dotenv';\r\nimport { join } from 'path';\r\n\r\nconst env: { [key: string]: any } = dotenv.config({\r\n  path: join(__dirname, 'environments', '.prod.env'),\r\n}).parsed;\r\n\r\nenv.COOKIE_KEYS = env.COOKIE_KEYS.split(';');\r\n\r\nexport const environment = {\r\n  production: true,\r\n\r\n  ...env,\r\n};\r\n","module.exports = require(\"fs-extra\");","import admin from 'firebase-admin';\r\nexport const serviceAccount = require('./firebaseCredentials.json');\r\n\r\n// Initialize Firebase\r\nadmin.initializeApp({\r\n  credential: admin.credential.cert(serviceAccount),\r\n  storageBucket: 'cslussana.appspot.com',\r\n});\r\n\r\n// Export variable for Firebase bucket\r\nexport const bucket = admin.storage().bucket();\r\n","module.exports = require(\"os\");","module.exports = require(\"passport\");","import mongoose, { Schema } from 'mongoose';\r\nimport { bucket } from '@config/firebase';\r\nimport { join } from 'path';\r\nimport { tmpdir } from 'os';\r\nimport fse from 'fs-extra';\r\nimport sharp from 'sharp';\r\nimport { IProduct, IProductModel } from '@csl/shared';\r\n\r\nconst ProductSchema = new Schema(\r\n  {\r\n    id: { type: String, required: true, unique: true },\r\n    name: { type: String, required: true },\r\n    description: { type: String, required: true },\r\n    category: { type: String, required: true },\r\n    price: { type: Number, required: true },\r\n    fileNames: { type: Array, required: true },\r\n    colors: { type: Array },\r\n    sizes: { type: Array },\r\n  },\r\n  { versionKey: false }\r\n);\r\n\r\nexport const Product = mongoose.model<IProductModel>('product', ProductSchema, 'gadgets');\r\n\r\n// Get all gadgets in the database\r\nexport const getAllGadgets = async () => {\r\n  const res = await Product.find({ category: 'gadgets' });\r\n\r\n  return res;\r\n};\r\n\r\n// Create a new gadget\r\nexport const createGadget = async (product: IProduct) => {\r\n  let { id, name, description, price, fileNames, colors, sizes } = product;\r\n  let category = 'gadgets';\r\n\r\n  const workingDir = join(tmpdir(), 'images');\r\n  fse.ensureDir(workingDir);\r\n\r\n  const uploadPromises = fileNames.map(async (tmpFileName: any) => {\r\n    let tmpFilePath = join(workingDir, tmpFileName);\r\n    let pngFileName = tmpFileName.split('.').shift() + '.png';\r\n    let pngFilePath = join(workingDir, pngFileName);\r\n    let newFileName = `500@${pngFileName}`;\r\n    let newFilePath = join(workingDir, newFileName);\r\n\r\n    await bucket.file(`gadgetImages/raw/${tmpFileName}`).download({\r\n      destination: tmpFilePath,\r\n    });\r\n\r\n    await sharp(tmpFilePath).toFormat('png').toFile(pngFilePath);\r\n\r\n    await sharp(pngFilePath)\r\n      .resize({\r\n        width: 500,\r\n        height: 500,\r\n        fit: 'contain',\r\n        background: { r: 0, g: 0, b: 0, alpha: 0 },\r\n      })\r\n      .toFile(newFilePath);\r\n\r\n    return bucket.upload(newFilePath, {\r\n      destination: `gadgetImages/${id}/${newFileName}`,\r\n    });\r\n  });\r\n\r\n  await Promise.all(uploadPromises);\r\n\r\n  fse.remove(workingDir);\r\n\r\n  fileNames = fileNames.map((fileName: any) => {\r\n    return `500@${fileName.split('.').shift()}.png`;\r\n  });\r\n\r\n  return new Product({\r\n    id,\r\n    name,\r\n    description,\r\n    category,\r\n    price,\r\n    fileNames,\r\n    colors,\r\n    sizes,\r\n  })\r\n    .save()\r\n    .then((res: any) => {\r\n      return { success: true };\r\n    })\r\n    .catch((err: any) => {\r\n      return { err };\r\n    });\r\n};\r\n\r\n// Get all photo products in the database\r\nexport const getAllPhotos = async () => {\r\n  const res = await Product.find({ category: 'photos' });\r\n\r\n  return res;\r\n};\r\n\r\n// Create a new photo product\r\nexport const createPhoto = async (product: IProduct) => {\r\n  let { id, name, description, price, fileNames } = product;\r\n  let category = 'photos';\r\n\r\n  const workingDir = join(tmpdir(), 'images');\r\n  fse.ensureDir(workingDir);\r\n\r\n  const uploadPromises = fileNames.map(async (tmpFileName: any) => {\r\n    let tmpFilePath = join(workingDir, tmpFileName);\r\n    let pngFileName = tmpFileName.split('.').shift() + '.png';\r\n    let pngFilePath = join(workingDir, pngFileName);\r\n    let newFileName = `500@${pngFileName}`;\r\n    let newFilePath = join(workingDir, newFileName);\r\n\r\n    await bucket.file(`photoImages/raw/${tmpFileName}`).download({\r\n      destination: tmpFilePath,\r\n    });\r\n\r\n    await sharp(tmpFilePath).toFormat('png').toFile(pngFilePath);\r\n\r\n    await sharp(pngFilePath)\r\n      .resize({\r\n        width: 500,\r\n        height: 500,\r\n        fit: 'contain',\r\n        background: { r: 0, g: 0, b: 0, alpha: 0 },\r\n      })\r\n      .toFile(newFilePath);\r\n\r\n    return bucket.upload(newFilePath, {\r\n      destination: `photoImages/${id}/${newFileName}`,\r\n    });\r\n  });\r\n\r\n  await Promise.all(uploadPromises);\r\n\r\n  fse.remove(workingDir);\r\n\r\n  fileNames = fileNames.map((fileName: any) => {\r\n    return `500@${fileName.split('.').shift()}.png`;\r\n  });\r\n\r\n  return new Product({\r\n    id,\r\n    name,\r\n    description,\r\n    category,\r\n    price,\r\n    fileNames,\r\n  })\r\n    .save()\r\n    .then((res: any) => {\r\n      return { success: true };\r\n    })\r\n    .catch((err: any) => {\r\n      return { err };\r\n    });\r\n};\r\n\r\n// Get product based on product ID\r\nexport const findProduct = async (id: IProduct['id']) => {\r\n  const res = await Product.findOne({ id });\r\n\r\n  return res;\r\n};\r\n\r\n// Delete product based on product ID\r\nexport const deleteProduct = async (id: IProduct['id']) => {\r\n  const result = await Product.findOneAndDelete({ id })\r\n    .then((res) => {\r\n      return {\r\n        success: true,\r\n      };\r\n    })\r\n    .catch((err) => {\r\n      return {\r\n        success: false,\r\n        err,\r\n      };\r\n    });\r\n\r\n  return result;\r\n};\r\n","import mongoose, { Schema } from 'mongoose';\r\nimport { ISnack, ISnackModel } from '@csl/shared';\r\n\r\nconst SnackSchema = new Schema(\r\n  {\r\n    id: { type: String, required: true, unique: true },\r\n    name: { type: String, required: true },\r\n    description: { type: String, required: true },\r\n    price: { type: Number, required: true },\r\n    maxQuantity: { type: Number, required: true },\r\n  },\r\n  { versionKey: false }\r\n);\r\n\r\nexport const Snack = mongoose.model<ISnackModel>('snack', SnackSchema);\r\n\r\nexport const createSnack = (snack: ISnack) => {\r\n  return new Snack(snack)\r\n    .save()\r\n    .then((res) => {\r\n      return {\r\n        success: true,\r\n      };\r\n    })\r\n    .catch((err) => {\r\n      return {\r\n        success: false,\r\n        err,\r\n      };\r\n    });\r\n};\r\n\r\nexport const deleteSnack = (id: ISnack['id']) => {\r\n  return Snack.findOneAndDelete({ id })\r\n    .then((res) => {\r\n      return {\r\n        success: true,\r\n      };\r\n    })\r\n    .catch((err) => {\r\n      return {\r\n        success: false,\r\n        err,\r\n      };\r\n    });\r\n};\r\n\r\nexport const updateMaxQuantity = async (\r\n  maxQuantity: ISnack['maxQuantity'],\r\n  id: ISnack['id']\r\n) => {\r\n  const result = await Snack.findOneAndUpdate({ id }, { maxQuantity })\r\n    .then((res) => {\r\n      return { success: true };\r\n    })\r\n    .catch((err) => {\r\n      return { success: false, err };\r\n    });\r\n\r\n  return result;\r\n};\r\n\r\nexport const getSnacks = async () => {\r\n  const result = await Snack.find();\r\n\r\n  return result;\r\n};\r\n","import mongoose, { Schema } from 'mongoose';\r\nimport { Product } from '@controllers/product';\r\nimport { IOrder, IOrderModel, IProductInCart, IProduct, IUser, IHttpRes } from '@csl/shared';\r\n\r\nconst OrderSchema = new Schema(\r\n  {\r\n    id: { type: String, required: true, unique: true },\r\n    gadgets: { type: Array, required: true, default: [] },\r\n    photos: { type: Array, required: true, default: [] },\r\n    gadgetTotal: { type: Number, required: true, default: 0 },\r\n    photoTotal: { type: Number, required: true, default: 0 },\r\n    gadgetsConfirmed: { type: Boolean, required: true, default: false },\r\n    photosConfirmed: { type: Boolean, required: true, default: false },\r\n    classID: { type: String, required: true },\r\n  },\r\n  { skipVersioning: true }\r\n);\r\n\r\nexport const Order = mongoose.model<IOrderModel>('order', OrderSchema, 'gadget-orders');\r\n\r\n// Create a new order\r\nexport const addToCart = async (product: IProductInCart, user: IUser): Promise<IHttpRes<any>> => {\r\n  const productInDb = await Product.findOne({ id: product.id }).then(\r\n    (res: IProduct | null) => {\r\n      return {\r\n        price: res!.price * product.quantity * 100,\r\n        category: res!.category,\r\n      };\r\n    }\r\n  );\r\n\r\n  const categoryConfirmed =\r\n    productInDb.category === 'gadgets' ? 'gadgetsConfirmed' : 'photosConfirmed';\r\n\r\n  return Order.findOne({\r\n    id: user.id,\r\n  }).then((order: IOrder | null) => {\r\n    if (!order) {\r\n      // Case in which an order with this ID doesn't exist\r\n      const gadgetTotal =\r\n        productInDb.category === 'gadgets' ? productInDb.price : 0;\r\n      const photoTotal =\r\n        productInDb.category === 'photos' ? productInDb.price : 0;\r\n\r\n      const gadgets = productInDb.category === 'gadgets' ? [product] : [];\r\n      const photos = productInDb.category === 'photos' ? [product] : [];\r\n\r\n      return new Order({\r\n        gadgets,\r\n        photos,\r\n        id: user.id,\r\n        gadgetTotal,\r\n        photoTotal,\r\n        confirmed: false,\r\n        classID: user.classID,\r\n      })\r\n        .save()\r\n        .then((res) => {\r\n          return {\r\n            success: true,\r\n          };\r\n        });\r\n    } else if (order[categoryConfirmed] === true) {\r\n      // Case in which the order for this category is already confirmed\r\n      return {\r\n        success: false,\r\n        err: 'already-confirmed',\r\n      };\r\n    } else {\r\n      // Case in which an order exists, is not confirmed but needs to be updated\r\n      const gadgetTotal =\r\n        productInDb.category === 'gadgets'\r\n          ? order.gadgetTotal + productInDb.price\r\n          : order.gadgetTotal;\r\n\r\n      const photoTotal =\r\n        productInDb.category === 'photos'\r\n          ? order.photoTotal + productInDb.price\r\n          : order.photoTotal;\r\n\r\n      return Order.findOneAndUpdate(\r\n        { id: user.id },\r\n        { $push: { [productInDb.category]: product }, gadgetTotal, photoTotal }\r\n      ).then((res) => {\r\n        return {\r\n          success: true,\r\n        };\r\n      });\r\n    }\r\n  });\r\n};\r\n\r\n// Confirm an order\r\nexport const confirmOrder = async (id: any, category: any) => {\r\n  const confirmedCategory =\r\n    category === 'gadgets' ? 'gadgetsConfirmed' : 'photosConfirmed';\r\n\r\n  const confirmedTotal = category === 'gadgets' ? 'gadgetTotal' : 'photoTotal';\r\n\r\n  return Order.findOneAndUpdate(\r\n    { id },\r\n    {\r\n      [confirmedCategory]: true,\r\n    }\r\n  ).then((res: any) => {\r\n    return res[confirmedTotal];\r\n  });\r\n};\r\n\r\n// Get all orders of a user\r\nexport const getAllOrders = async (id: any) => {\r\n  return Order.findOne({ id }).then((res: any) => {\r\n    return {\r\n      gadgets: res.gadgets,\r\n      photos: res.photos,\r\n      gadgetsConfirmed: res.gadgetsConfirmed,\r\n      photosConfirmed: res.photosConfirmed,\r\n    };\r\n  });\r\n};\r\n\r\n// Delete an order\r\nexport const deleteFromCart = async (id: any, product: any) => {\r\n  const productInDb: IProduct = await Product.findOne({\r\n    id: product.id,\r\n  }).then((res) => {\r\n    return res!;\r\n  });\r\n\r\n  const category = productInDb.category;\r\n  const singlePrice = productInDb.price;\r\n  const categoryConfirmed =\r\n    category === 'gadgets' ? 'gadgetsConfirmed' : 'photosConfirmed';\r\n\r\n  const newTotal: number | false = await Order.findOne({ id }).then(\r\n    async (res) => {\r\n      if (res![categoryConfirmed] === true) {\r\n        return false;\r\n      }\r\n\r\n      const productInCart = res![category].find(\r\n        (obj) =>\r\n          obj.id == product.id &&\r\n          obj.size == product.size &&\r\n          obj.color == obj.color &&\r\n          obj.quantity == product.quantity\r\n      );\r\n\r\n      const quantity = productInCart!.quantity;\r\n      const oldTotal =\r\n        category === 'gadgets' ? res!.gadgetTotal : res!.photoTotal;\r\n\r\n      return oldTotal - singlePrice * quantity * 100;\r\n    }\r\n  );\r\n\r\n  if (newTotal === false) {\r\n    return {\r\n      success: false,\r\n      err: 'Your order has already been confirmed',\r\n    };\r\n  }\r\n\r\n  const totalToChange = category === 'gadgets' ? 'gadgetTotal' : 'photoTotal';\r\n\r\n  const res = await Order.findOneAndUpdate(\r\n    { id },\r\n    {\r\n      $pull: {\r\n        [category]: {\r\n          id: product.id,\r\n          size: product.size,\r\n          color: product.color,\r\n          quantity: product.quantity,\r\n        },\r\n      },\r\n      [totalToChange]: newTotal,\r\n    }\r\n  )\r\n    .then((res) => {\r\n      return {\r\n        success: true,\r\n        msg: 'Order deleted',\r\n      };\r\n    })\r\n    .catch((err) => {\r\n      return {\r\n        success: false,\r\n        err,\r\n      };\r\n    });\r\n\r\n  return res;\r\n};\r\n","import mongoose, { Schema } from 'mongoose';\r\nimport { ISnackOrderModel, ISnackInCart, ISnack, IUser } from '@csl/shared';\r\nimport { Snack } from '@controllers/snack';\r\nimport { User } from '@controllers/user';\r\nimport { Class } from '@controllers/classe';\r\nimport { Server } from 'socket.io';\r\n\r\nconst SnackOrderSchema = new Schema(\r\n  {\r\n    id: { type: String, required: true },\r\n    cart: { type: Array, required: true },\r\n    date: { type: String, required: true },\r\n    total: { type: Number, required: true },\r\n    confirmed: { type: Boolean, required: true, default: false },\r\n    name: { type: String, required: true },\r\n    classID: { type: String, required: true },\r\n  },\r\n  { versionKey: false }\r\n);\r\n\r\nexport const SnackOrder = mongoose.model<ISnackOrderModel>(\r\n  'snack-order',\r\n  SnackOrderSchema,\r\n  'snack-orders'\r\n);\r\n\r\nexport const addSnackToCart = async (id: ISnack['id'], user: IUser) => {\r\n  const date = new Date();\r\n\r\n  const day = date.getDate();\r\n  const month = date.getMonth() + 1;\r\n  const year = date.getFullYear();\r\n\r\n  const today = `${day}-${month}-${year}`;\r\n\r\n  const result = await SnackOrder.findOne({ id: user.id, date: today }).then(\r\n    async (order) => {\r\n      if (order && order.confirmed) {\r\n        return {\r\n          success: false,\r\n          code: 'order-confirmed',\r\n        };\r\n      }\r\n\r\n      const snack = await Snack.findOneAndUpdate(\r\n        { id },\r\n        { $inc: { maxQuantity: -1 } }\r\n      );\r\n\r\n      if (!order) {\r\n        const productInCart: ISnackInCart = {\r\n          id,\r\n          name: snack!.name,\r\n          quantity: 1,\r\n        };\r\n\r\n        return new SnackOrder({\r\n          id: user.id,\r\n          cart: [productInCart],\r\n          date: today,\r\n          total: snack!.price,\r\n          classID: user.classID,\r\n          name: `${user.firstName} ${user.lastName}`,\r\n        })\r\n          .save()\r\n          .then((res) => {\r\n            return { success: true };\r\n          })\r\n          .catch((err) => {\r\n            return {\r\n              success: false,\r\n              error: err,\r\n            };\r\n          });\r\n      } else if (order) {\r\n        let index: number | undefined;\r\n        const productExists = order.cart.find((x) => x.id === id);\r\n\r\n        if (productExists) {\r\n          index = order.cart.findIndex((x) => x.id === id);\r\n        } else {\r\n          index = undefined;\r\n        }\r\n\r\n        if (typeof index !== 'undefined') {\r\n          const quantityQuery = `cart.${index}.quantity`;\r\n          let update = {\r\n            $inc: { [quantityQuery]: 1, total: snack!.price },\r\n          };\r\n\r\n          return SnackOrder.findOneAndUpdate(\r\n            { id: user.id, date: today },\r\n            update\r\n          )\r\n            .then((res) => {\r\n              return { success: true };\r\n            })\r\n            .catch((err) => {\r\n              return { success: false, err };\r\n            });\r\n        } else {\r\n          const productInCart: ISnackInCart = {\r\n            id,\r\n            name: snack!.name,\r\n            quantity: 1,\r\n          };\r\n\r\n          return SnackOrder.findOneAndUpdate(\r\n            { id: user.id, date: today },\r\n            {\r\n              $push: { cart: productInCart },\r\n              $inc: { total: snack!.price },\r\n            }\r\n          )\r\n            .then((res) => {\r\n              return { success: true };\r\n            })\r\n            .catch((err) => {\r\n              return { success: false, err };\r\n            });\r\n        }\r\n      }\r\n    }\r\n  );\r\n\r\n  return result;\r\n};\r\n\r\nexport const getSnacksCart = async (id: IUser['id']) => {\r\n  const date = new Date();\r\n\r\n  const day = date.getDate();\r\n  const month = date.getMonth() + 1;\r\n  const year = date.getFullYear();\r\n\r\n  const today = `${day}-${month}-${year}`;\r\n\r\n  const result = await SnackOrder.findOne({ id, date: today });\r\n\r\n  return result;\r\n};\r\n\r\nexport const deleteSnackFromCart = async (\r\n  id: ISnack['id'],\r\n  userID: IUser['id']\r\n) => {\r\n  const date = new Date();\r\n\r\n  const day = date.getDate();\r\n  const month = date.getMonth() + 1;\r\n  const year = date.getFullYear();\r\n\r\n  const today = `${day}-${month}-${year}`;\r\n\r\n  const previousOrder = await SnackOrder.findOne({ id: userID, date: today });\r\n\r\n  if (previousOrder!.confirmed === true) {\r\n    return {\r\n      success: false,\r\n      err: 'order-confirmed',\r\n    };\r\n  }\r\n\r\n  const index: number = previousOrder!.cart.findIndex((x) => x.id === id);\r\n  const quantity: number = previousOrder!.cart[index].quantity;\r\n\r\n  const snack = await Snack.findOneAndUpdate(\r\n    { id },\r\n    { $inc: { maxQuantity: quantity } }\r\n  );\r\n\r\n  const price: number = snack!.price;\r\n\r\n  const removedTotal = -quantity * price;\r\n\r\n  const result = await SnackOrder.findOneAndUpdate(\r\n    { id: userID, date: today },\r\n    {\r\n      $pull: {\r\n        cart: {\r\n          id,\r\n        },\r\n      },\r\n      $inc: {\r\n        total: removedTotal,\r\n      },\r\n    },\r\n    { new: true }\r\n  )\r\n    .then(async (res) => {\r\n      if (res!.cart.length === 0) {\r\n        await SnackOrder.findOneAndRemove({ id: userID, date: today });\r\n      }\r\n\r\n      return { success: true };\r\n    })\r\n    .catch((err) => {\r\n      return { success: false, err };\r\n    });\r\n\r\n  return result;\r\n};\r\n\r\nexport const confirmSnackOrder = async (user: IUser) => {\r\n  const date = new Date();\r\n\r\n  const day = date.getDate();\r\n  const month = date.getMonth() + 1;\r\n  const year = date.getFullYear();\r\n\r\n  const today = `${day}-${month}-${year}`;\r\n\r\n  const result = await SnackOrder.findOne({ id: user.id, date: today })\r\n    .then((order) => {\r\n      if (order!.total > user.snackCredit) {\r\n        return { success: false, err: 'no-credit' };\r\n      } else {\r\n        return User.findOneAndUpdate(\r\n          { id: user.id },\r\n          { $inc: { snackCredit: -order!.total } },\r\n          { new: true }\r\n        ).then((res) => {\r\n          Class.findOneAndUpdate(\r\n            { id: user.classID, 'members.email': user.email },\r\n            { $set: { 'members.$.snackCredit': res!.snackCredit } }\r\n          ).then();\r\n\r\n          return SnackOrder.findOneAndUpdate(\r\n            { id: user.id, date: today },\r\n            { confirmed: true }\r\n          )\r\n            .then((res) => {\r\n              return { success: true };\r\n            })\r\n            .catch((err) => {\r\n              return { success: false, err };\r\n            });\r\n        });\r\n      }\r\n    })\r\n    .catch((err) => {\r\n      return { success: false, err };\r\n    });\r\n\r\n  return result;\r\n};\r\n\r\nexport const snackOrderConfig = (io: Server) => {\r\n  SnackOrder.watch([], {\r\n    fullDocument: 'updateLookup',\r\n  }).on('change', (change: any) => {\r\n    if (change.operationType === 'insert' || 'replace') {\r\n      io.to('Bar Admin').emit('Orders', {\r\n        change: change.fullDocument,\r\n        operationType: change.operationType,\r\n      });\r\n    } else if (change.operationType === 'delete') {\r\n      io.to('Bar Admin').emit('Orders', {\r\n        change: { _id: change.documentKey._id },\r\n        operationType: change.operationType,\r\n      });\r\n    }\r\n  });\r\n\r\n  io.on('connection', async (socket) => {\r\n    socket.join('Bar Admin');\r\n\r\n    const date = new Date();\r\n\r\n    const day = date.getDate();\r\n    const month = date.getMonth() + 1;\r\n    const year = date.getFullYear();\r\n\r\n    const today = `${day}-${month}-${year}`;\r\n\r\n    const orders = await SnackOrder.find({ date: today });\r\n\r\n    const classes = [...new Set(orders.map((order) => order.classID).sort())];\r\n\r\n    io.to('Bar Admin').emit('Orders', {\r\n      orders,\r\n      classes,\r\n    });\r\n  });\r\n};\r\n","module.exports = require(\"stripe\");","import { Schema, model } from 'mongoose';\r\nimport { IArticleModel, IArticle, IHttpRes, IUser } from '@csl/shared';\r\nimport { saveError, saveEvent } from '@config/winston';\r\n\r\nconst ArticleSchema = new Schema(\r\n  {\r\n    id: { type: String, required: true, unique: true },\r\n    title: { type: String, required: true },\r\n    content: { type: Object, required: true },\r\n    author: { type: String, required: true },\r\n    category: { type: String, required: true },\r\n    estimatedTime: { type: Number },\r\n    image: { type: String },\r\n    published: { type: Boolean, default: false, required: true },\r\n    date: { type: Date },\r\n  },\r\n  { skipVersioning: true }\r\n);\r\n\r\nexport const Article = model<IArticleModel>('article', ArticleSchema);\r\n\r\nexport const getArticles = async (): Promise<IHttpRes<IArticle[]>> => {\r\n  return Article.find()\r\n    .then((data) => {\r\n      return {\r\n        success: true,\r\n        data,\r\n      };\r\n    })\r\n    .catch((err) => {\r\n      return {\r\n        success: false,\r\n        err,\r\n      };\r\n    });\r\n};\r\n\r\nexport const getArticle = async (\r\n  id: IArticle['id']\r\n): Promise<IHttpRes<IArticle>> => {\r\n  return Article.findOne({ id })\r\n    .then((data) => {\r\n      return {\r\n        success: true,\r\n        data,\r\n      };\r\n    })\r\n    .catch((err) => {\r\n      return {\r\n        success: false,\r\n        err,\r\n      };\r\n    });\r\n};\r\n\r\n// Save a new article\r\nexport const saveArticle = async (\r\n  article: IArticle,\r\n  id: IArticle['id']\r\n): Promise<IHttpRes<any>> => {\r\n  const exists = (await Article.findOne({ id })) ? true : false;\r\n\r\n  const { title, category, author, estimatedTime, content, image } = article;\r\n\r\n  if (!exists) {\r\n    const date = new Date();\r\n\r\n    return new Article({\r\n      content,\r\n      id,\r\n      title,\r\n      category,\r\n      author,\r\n      estimatedTime,\r\n      image,\r\n      date,\r\n    })\r\n      .save()\r\n      .then((res) => {\r\n        return {\r\n          success: true,\r\n          data: {\r\n            articleID: id,\r\n          },\r\n        };\r\n      })\r\n      .catch((err) => {\r\n        return {\r\n          success: false,\r\n          err,\r\n        };\r\n      });\r\n  } else if (exists) {\r\n    return Article.findOneAndUpdate(\r\n      { id },\r\n      { content, title, category, author, estimatedTime }\r\n    )\r\n      .then((res) => {\r\n        return {\r\n          success: true,\r\n          data: {\r\n            articleID: id,\r\n          },\r\n        };\r\n      })\r\n      .catch((err) => {\r\n        return {\r\n          success: false,\r\n          err,\r\n        };\r\n      });\r\n  }\r\n};\r\n\r\nexport const changeArticlePublished = async (id: IArticle['id'], state: IArticle['published'], user: IUser): Promise<IHttpRes<any>> => {\r\n  try {\r\n    await Article.findOneAndUpdate({ id }, { published: state });\r\n\r\n    saveEvent(`Modificato stato dell'articolo '${id}'`, {\r\n      category: 'qp',\r\n      user: user.email,\r\n      newState: state,\r\n    })\r\n\r\n    return {\r\n      success: true,\r\n    }\r\n  } catch (err) {\r\n    saveError(`Errore durante il tentativo di modifica dello stato dell'articolo '${id}'`, {\r\n      category: 'qp',\r\n      user: user.email,\r\n      err \r\n    })\r\n  }\r\n}\r\n\r\nexport const deleteArticle = async (id: IArticle['id']): Promise<IHttpRes<any>> => {\r\n  const res = await Article.findOneAndDelete({ id })\r\n    .then((res) => {\r\n      return {\r\n        success: true,\r\n      };\r\n    })\r\n    .catch((err) => {\r\n      return {\r\n        success: false,\r\n        err,\r\n      };\r\n    });\r\n\r\n  return res;\r\n};\r\n","import mongoose, { Schema } from 'mongoose';\r\nimport { ICommissione, ICommissioneModel, IHttpRes, IUser } from '@csl/shared';\r\nimport { saveError, saveEvent } from '@config/winston';\r\n\r\nconst CommissioneSchema = new Schema(\r\n  {\r\n    id: { type: String, required: true, unique: true },\r\n    title: { type: String, required: true },\r\n    page: { type: Object },\r\n    image: { type: String },\r\n  },\r\n  { skipVersioning: true }\r\n);\r\n\r\nexport const Commissione = mongoose.model<ICommissioneModel>(\r\n  'commissione',\r\n  CommissioneSchema,\r\n  'commissioni'\r\n);\r\n\r\nexport const getCommissione = async (\r\n  id: ICommissione['id']\r\n): Promise<IHttpRes<ICommissione>> => {\r\n  try {\r\n    const commissione = await Commissione.findOne({ id });\r\n\r\n    return {\r\n      success: true,\r\n      data: commissione,\r\n    };\r\n  } catch (err) {\r\n    return {\r\n      success: false,\r\n      err,\r\n    };\r\n  }\r\n};\r\n\r\nexport const setPage = async (\r\n  id: ICommissione['id'],\r\n  page: ICommissione['page'],\r\n  user: IUser\r\n): Promise<IHttpRes<any>> => {\r\n  try {\r\n    await Commissione.findOneAndUpdate({ id }, { page });\r\n\r\n    saveEvent(`Modificata la pagina della commissione ${id}`, {\r\n      user: user.email,\r\n      category: 'commissioni',\r\n    });\r\n\r\n    return {\r\n      success: true,\r\n    };\r\n  } catch (err) {\r\n    saveError(\r\n      `Errore durante la modifica della pagina della commissione ${id}`,\r\n      {\r\n        user: user.email,\r\n        category: 'commissioni',\r\n        err,\r\n      }\r\n    );\r\n\r\n    return {\r\n      success: false,\r\n    };\r\n  }\r\n};\r\n\r\nexport const createCommissione = async (\r\n  commissione: ICommissione,\r\n  user: IUser\r\n) => {\r\n  try {\r\n    await new Commissione(commissione).save().then();\r\n\r\n    saveEvent(`Created commissione \"${commissione.id}\"`, {\r\n      user: user.email,\r\n      category: 'commissioni',\r\n    });\r\n\r\n    return {\r\n      success: true,\r\n    };\r\n  } catch (err) {\r\n    saveError(`Error during the creation of commissione \"${commissione.id}\"`, {\r\n      user: user.email,\r\n      category: 'commissioni',\r\n      err\r\n    });\r\n  }\r\n};\r\n","module.exports = require(\"sharp\");","module.exports = require(\"uuid\");","module.exports = require(\"firebase-admin\");","import mongoose, { Schema } from 'mongoose';\r\nimport { IBugData, IHttpRes, IReport, IReportModel, IUser } from '@csl/shared';\r\nimport { v4 } from 'uuid';\r\nimport { saveError } from '@config/winston';\r\n\r\nconst ReportSchema = new Schema(\r\n  {\r\n    id: { type: String, required: true, unique: true },\r\n    user: { type: String },\r\n    firstName: { type: String, required: true },\r\n    lastName: { type: String, required: true },\r\n    classID: { type: String, required: true },\r\n    date: { type: Date, required: true },\r\n    solved: { type: Boolean, default: false },\r\n    bug: { type: Object },\r\n  },\r\n  { skipVersioning: true }\r\n);\r\n\r\nexport const Report = mongoose.model<IReportModel>('report', ReportSchema);\r\n\r\nexport const reportBug = async (\r\n  user: IUser,\r\n  bug: IBugData\r\n): Promise<IHttpRes<any>> => {\r\n  const date = new Date();\r\n\r\n  return new Report({\r\n    id: v4(),\r\n    user: user.id,\r\n    firstName: user.firstName,\r\n    lastName: user.lastName,\r\n    classID: user.classID,\r\n    date,\r\n    bug,\r\n  })\r\n    .save()\r\n    .then(() => {\r\n      return {\r\n        success: true,\r\n      };\r\n    })\r\n    .catch((err) => {\r\n      return {\r\n        success: false,\r\n        err,\r\n      };\r\n    });\r\n};\r\n\r\nexport const getReports = async (): Promise<IHttpRes<IReportModel[]>> => {\r\n  return Report.find()\r\n    .then((data) => {\r\n      return {\r\n        success: true,\r\n        data,\r\n      };\r\n    })\r\n    .catch((err) => {\r\n      return {\r\n        success: false,\r\n        err,\r\n      };\r\n    });\r\n};\r\n\r\nexport const toggleSolved = async (\r\n  id: IReport['id'],\r\n  solved: IReport['solved']\r\n): Promise<IHttpRes<any>> => {\r\n  try {\r\n    await Report.findOneAndUpdate({ id }, { solved });\r\n\r\n    return {\r\n      success: true,\r\n    };\r\n  } catch (err) {\r\n    saveError(`Error while toggling solved state on report ${id}`, {\r\n      category: 'reports',\r\n      err,\r\n    });\r\n\r\n    return {\r\n      success: false,\r\n    };\r\n  }\r\n};\r\n","module.exports = require(\"winston\");","module.exports = require(\"winston-mongodb\");","import { Schema, model } from 'mongoose';\r\nimport { ILogModel, IUser } from '@csl/shared';\r\nimport { saveError } from '@config/winston';\r\n\r\nconst LogSchema = new Schema(\r\n  {\r\n    timestamp: { type: Date, required: true },\r\n    level: { type: String, required: true },\r\n    message: { type: String, required: true },\r\n    metadata: { type: Object, required: true },\r\n  },\r\n  { skipVersioning: true }\r\n);\r\n\r\nconst Error = model<ILogModel>('error', LogSchema, 'errors');\r\nconst Event = model<ILogModel>('event', LogSchema, 'events');\r\n\r\nexport const getErrors = async (user: IUser) => {\r\n  try {\r\n    const errors = await Error.find();\r\n\r\n    return {\r\n      success: true,\r\n      data: errors\r\n    }\r\n  } catch (err) {\r\n    saveError(\"Error during errors' retrieving\", {\r\n      category: 'logs',\r\n      user: user.email,\r\n      err: err\r\n    })\r\n\r\n    return {\r\n      success: false\r\n    }\r\n  }\r\n}\r\n\r\nexport const getEvents = async (user: IUser) => {\r\n  try {\r\n    const events = await Event.find();\r\n\r\n    return {\r\n      success: true,\r\n      data: events\r\n    }\r\n  } catch (err) {\r\n    saveError(\"Error during events' retrieving\", {\r\n      category: 'logs',\r\n      user: user.email,\r\n      err: err\r\n    })\r\n\r\n    return {\r\n      success: false\r\n    }\r\n  }\r\n}\r\n","import { Schema, model } from 'mongoose';\r\nimport { ICourse, ICourseModel, IHttpRes, IUser } from '@csl/shared';\r\nimport { v4 } from 'uuid';\r\n\r\nconst CourseSchema = new Schema({\r\n  id: { type: String, required: true, unique: true },\r\n  title: { type: String, required: true },\r\n  description: { type: String, required: true },\r\n  notes: { type: String },\r\n  duration: { type: Number, required: true },\r\n  slots: { type: Array, required: true },\r\n  owner: { type: String, required: true },\r\n  speakers: { type: Array, required: true },\r\n  status: { type: String, required: true, default: 'WAITING' },\r\n});\r\n\r\nexport const Course = model<ICourseModel>('course', CourseSchema);\r\n\r\nexport const createCourse = async (\r\n  courseData: ICourse,\r\n  user: IUser\r\n): Promise<IHttpRes<any>> => {\r\n  const id = v4();\r\n  const owner = user.id;\r\n\r\n  const { title, description, notes, duration, slots, speakers } = courseData;\r\n\r\n  return new Course({\r\n    id,\r\n    title,\r\n    description,\r\n    notes,\r\n    duration,\r\n    slots,\r\n    owner,\r\n    speakers,\r\n  })\r\n    .save()\r\n    .then(() => {\r\n      return {\r\n        success: true,\r\n      };\r\n    })\r\n    .catch((err) => {\r\n      return {\r\n        success: false,\r\n        err,\r\n      };\r\n    });\r\n};\r\n\r\nexport const getCourses = (user: IUser): Promise<IHttpRes<ICourse[]>> => {\r\n  return Course.find({ owner: user.id })\r\n    .then((courses) => {\r\n      return {\r\n        success: true,\r\n        data: courses,\r\n      };\r\n    })\r\n    .catch((err) => {\r\n      return {\r\n        success: false,\r\n        err,\r\n      };\r\n    });\r\n};\r\n","module.exports = require(\"dotenv\");","module.exports = require(\"cors\");","module.exports = require(\"express-fileupload\");","module.exports = require(\"cookie-session\");","import { Request, Response } from 'express';\r\n\r\n// Stripe initialization\r\nimport { environment as env } from '@environments/environment';\r\nimport Stripe from 'stripe';\r\nconst stripe = new Stripe(env.STRIPE_KEY, {\r\n  apiVersion: '2020-08-27',\r\n  typescript: true,\r\n});\r\n\r\nimport { setPaid } from '@controllers/classe';\r\n\r\nexport async function webhookHandler(\r\n  req: Request,\r\n  res: Response\r\n): Promise<void> {\r\n  const sig: any = req.headers['stripe-signature'];\r\n\r\n  let event;\r\n\r\n  try {\r\n    event = stripe.webhooks.constructEvent(req.body, sig, env.WEBHOOK_SECRET);\r\n  } catch (err) {\r\n    // On error, log and return the error message\r\n    console.log(` Error message: ${err.message}`);\r\n    res.status(400).send(`Webhook Error: ${err.message}`);\r\n  }\r\n\r\n  if (event && event.type == 'payment_intent.succeeded') {\r\n    const dataObject: any = event.data.object;\r\n\r\n    await setPaid(\r\n      dataObject.metadata.Classe,\r\n      dataObject.metadata.Categoria\r\n    );\r\n  }\r\n\r\n  // Return a response to acknowledge receipt of the event\r\n  res.json({ received: true });\r\n}\r\n","module.exports = require(\"http\");","module.exports = require(\"socket.io\");","import { Server } from 'socket.io';\r\nimport { snackOrderConfig } from '@controllers/snack-order';\r\n\r\nexport const socketConfig = (socket: Server) => {\r\n  snackOrderConfig(socket);\r\n};\r\n","import { Router, Response } from 'express';\r\nconst router = Router();\r\nimport { IRequest } from '@csl/shared';\r\nimport { isAdmin } from '@config/authcheck';\r\nimport { createAccount, removeAccount } from '@controllers/user';\r\nimport { getEvents, getErrors } from '@controllers/log';\r\nimport { createCommissione } from '@controllers/commissione';\r\n\r\nrouter.get('/events', isAdmin, async (req: IRequest, res: Response) => {\r\n  const result = await getEvents(req.user);\r\n  res.json(result);\r\n});\r\n\r\nrouter.get('/errors', isAdmin, async (req: IRequest, res: Response) => {\r\n  const result = await getErrors(req.user);\r\n  res.json(result);\r\n});\r\n\r\nrouter.post('/accounts', isAdmin, async (req: IRequest, res: Response) => {\r\n  const result = await createAccount(req.body.account, req.user);\r\n  res.json(result);\r\n});\r\n\r\nrouter.delete(\r\n  '/accounts/:email',\r\n  isAdmin,\r\n  async (req: IRequest, res: Response) => {\r\n    const result = await removeAccount(req.params.email);\r\n    res.json(result);\r\n  }\r\n);\r\n\r\nrouter.post('/commissioni', isAdmin, async (req: IRequest, res: Response) => {\r\n  const result = await createCommissione(req.body.commissione, req.user);\r\n  res.json(result);\r\n});\r\n\r\nexport default router;\r\n","// Main imports\r\nimport { Request, Response, Router } from 'express';\r\nconst router = Router();\r\nimport { authCheck, profileCheck, notAuthCheck } from '@config/authcheck';\r\nimport passport from 'passport';\r\nimport { nextMiddelware } from '@config/login';\r\n\r\nrouter.get('/', profileCheck, (req: Request, res: Response) => {\r\n  res.json(req.user);\r\n});\r\n\r\nrouter.get(\r\n  '/redirect',\r\n  passport.authenticate('google', { failureRedirect: './failure' }),\r\n  (req: Request, res: Response) => {\r\n    const returnTo: string[] = req.session.returnTo.split('+');\r\n\r\n    res.redirect(`/${returnTo.join('/')}`);\r\n  }\r\n);\r\n\r\nrouter.get('/failure', notAuthCheck, (req: Request, res: Response) => {\r\n  res.redirect('/');\r\n});\r\n\r\nrouter.get('/logout', authCheck, (req: Request, res: Response) => {\r\n  req.logout();\r\n  res.redirect('/');\r\n});\r\n\r\nrouter.get(\r\n  '/:next',\r\n  notAuthCheck,\r\n  nextMiddelware,\r\n  passport.authenticate('google', {\r\n    scope: ['profile', 'email'],\r\n  })\r\n);\r\n\r\nexport default router;\r\n","import { NextFunction, Response } from 'express';\r\nimport { IRequest } from '@csl/shared';\r\n\r\nexport const nextMiddelware = (req: IRequest, res: Response, next: NextFunction) => {\r\n  req.session.returnTo = req.params.next;\r\n  next();\r\n}\r\n","import express from 'express';\r\nconst router = express.Router();\r\nimport { join } from 'path';\r\nimport { tmpdir } from 'os';\r\nimport csvUpload from '@config/csvupload';\r\nimport { isVice } from '@config/authcheck';\r\nimport { bucket } from '@config/firebase';\r\nimport fse from 'fs-extra';\r\nimport { UploadedFile } from 'express-fileupload';\r\n\r\n// Upload CSV file\r\nrouter.post('/csv', isVice, async (req, res) => {\r\n  if (!req.files) {\r\n    res.json({ uploadError: true });\r\n  } else {\r\n    const files: any = req.files;\r\n    const csv: UploadedFile = files.viceCsv;\r\n    const fileName = `${Date.now()}_${csv.name}`;\r\n    const workingDir = join(tmpdir(), 'csv');\r\n    const tmpFilePath = join(workingDir, fileName);\r\n\r\n    fse.ensureDir(workingDir);\r\n\r\n    await csv.mv(tmpFilePath);\r\n\r\n    const csvResult = await csvUpload(tmpFilePath).then((result) => {\r\n      return result;\r\n    });\r\n\r\n    await bucket.upload(tmpFilePath, {\r\n      destination: `csv/${fileName}`,\r\n    });\r\n\r\n    fse.remove(workingDir);\r\n\r\n    res.json(csvResult);\r\n  }\r\n});\r\n\r\nexport default router;\r\n","import csvtojson from 'csvtojson';\r\nimport { User } from '@controllers/user';\r\nimport { Class } from '@controllers/classe';\r\nimport { IUserInCsv } from '@csl/shared';\r\n\r\n// Function to find duplicates\r\nconst findDuplicates = (array: any) => {\r\n  var object: any = {};\r\n  var result: any = [];\r\n\r\n  array.forEach((item: any) => {\r\n    if (!object[item]) object[item] = 0;\r\n    object[item] += 1;\r\n  });\r\n\r\n  for (var prop in object) {\r\n    if (object[prop] >= 2) {\r\n      result.push(prop);\r\n    }\r\n  }\r\n\r\n  return result;\r\n};\r\n\r\n// Function to upload CSV to database\r\nexport default async (filePath: any) => {\r\n  return csvtojson({ delimiter: 'auto' })\r\n    .fromFile(filePath)\r\n    .then((json: IUserInCsv[]) => {\r\n      const emails = [];\r\n\r\n      for (let obj of json) {\r\n        emails.push(obj.email);\r\n      }\r\n\r\n      const duplicates = findDuplicates(emails);\r\n\r\n      if (duplicates.length > 0) {\r\n        return { success: false, duplicates };\r\n      } else {\r\n        const classes = [];\r\n\r\n        for (let account of json) {\r\n          let newUser = {\r\n            email: account.email,\r\n            firstName: account.nome,\r\n            lastName: account.cognome,\r\n            classID: account.classe,\r\n          };\r\n\r\n          let classObj = classes.find((x) => x.classID === newUser.classID);\r\n\r\n          if (classObj) {\r\n            let classIndex = classes.indexOf(classObj);\r\n            classes[classIndex].members.push({\r\n              email: newUser.email,\r\n              snackCredit: 0,\r\n              roles: [],\r\n            });\r\n          } else {\r\n            classes.push({\r\n              classID: newUser.classID,\r\n              members: [{ email: newUser.email, snackCredit: 0, roles: [] }],\r\n            });\r\n          }\r\n\r\n          User.findOne({ email: newUser.email }).then((user: any) => {\r\n            if (!user) {\r\n              new User(newUser).save();\r\n            }\r\n          });\r\n        }\r\n\r\n        classes.forEach((classObj) => {\r\n          Class.findOne({ classID: classObj.classID }).then((classDoc: any) => {\r\n            if (!classDoc) {\r\n              new Class({\r\n                id: classObj.classID,\r\n                members: classObj.members,\r\n                membersCount: classObj.members.length,\r\n                gadgetTotal: 0,\r\n                photoTotal: 0,\r\n              }).save();\r\n            }\r\n          });\r\n        });\r\n\r\n        return { success: true };\r\n      }\r\n    });\r\n};\r\n","module.exports = require(\"csvtojson\");","import { Request, Response, Router } from 'express';\r\nconst router = Router();\r\nimport { isRappre, isBar, isPowerful } from '@config/authcheck';\r\nimport { addRole, removeRole, getRoles, updateCredit } from '@controllers/user';\r\nimport { getClasses } from '@controllers/classe';\r\n\r\n// Get all members in classes\r\nrouter.get('/', isPowerful, async (req: Request, res: Response) => {\r\n  const classes = await getClasses();\r\n  res.json(classes);\r\n});\r\n\r\n// Add a role to a member\r\nrouter.post('/addrole', isRappre, async (req: Request, res: Response) => {\r\n  const result = await addRole(req.body.email, req.body.role);\r\n  res.json(result);\r\n});\r\n\r\n// Remove a role from a member\r\nrouter.post('/removerole', isRappre, async (req: Request, res: Response) => {\r\n  const result = await removeRole(req.body.email, req.body.role);\r\n  res.json(result);\r\n});\r\n\r\n// Get all roles of a specific member\r\nrouter.post('/getroles', isRappre, async (req: Request, res: Response) => {\r\n  const roles = await getRoles(req.body.email);\r\n  res.send(roles);\r\n});\r\n\r\n// Update credit of a user\r\nrouter.patch('/manage/credit/:email', isBar, async (req: Request, res: Response) => {\r\n  const result = await updateCredit(req.params.email, req.body.money);\r\n  res.json(result);\r\n})\r\n\r\nexport default router;\r\n","import { Request, Response, Router } from 'express';\r\nconst router = Router();\r\nimport { isQp, authCheck } from '@config/authcheck';\r\nimport {\r\n  saveArticle,\r\n  getArticle,\r\n  getArticles,\r\n  deleteArticle,\r\n  changeArticlePublished,\r\n} from '@controllers/article';\r\nimport fse from 'fs-extra';\r\nimport { tmpdir } from 'os';\r\nimport { join } from 'path';\r\nimport { UploadedFile } from 'express-fileupload';\r\nimport { bucket } from '@config/firebase';\r\nimport { IRequest } from '@csl/shared';\r\n\r\n// Images\r\nrouter.post('/image', isQp, async (req: Request, res: Response) => {\r\n  const files: any = req.files;\r\n  const image: UploadedFile = files.image;\r\n  const fileName = `${Date.now()}_${image.name}`;\r\n  const workingDir = join(tmpdir(), 'qp');\r\n  const tmpFilePath = join(workingDir, fileName);\r\n  const firebasePath = `articles/images/${fileName}`;\r\n  await fse.emptyDir(workingDir);\r\n\r\n  await image.mv(tmpFilePath);\r\n\r\n  await bucket.upload(tmpFilePath, {\r\n    destination: firebasePath,\r\n  });\r\n\r\n  res.json({\r\n    success: '1',\r\n    file: {\r\n      url: `/api/articles/image/${fileName}`,\r\n      firebasePath,\r\n    },\r\n  });\r\n});\r\n\r\nrouter.get(\r\n  '/image/:fileName',\r\n  authCheck,\r\n  async (req: Request, res: Response) => {\r\n    const firebasePath = `articles/images/${req.params.fileName}`;\r\n\r\n    const workingDir = join(tmpdir(), 'qp');\r\n    const tmpFilePath = join(workingDir, req.params.fileName);\r\n    await fse.emptyDir(workingDir);\r\n\r\n    await bucket.file(firebasePath).download({\r\n      destination: tmpFilePath,\r\n    });\r\n\r\n    res.sendFile(tmpFilePath);\r\n  }\r\n);\r\n\r\n// Article operations\r\nrouter.get('/', authCheck, async (req: Request, res: Response) => {\r\n  const articles = await getArticles();\r\n  res.json(articles);\r\n});\r\n\r\nrouter.get('/:id', authCheck, async (req: Request, res: Response) => {\r\n  const article = await getArticle(req.params.id);\r\n  res.json(article);\r\n});\r\n\r\nrouter.post('/:id', isQp, async (req: Request, res: Response) => {\r\n  const result = await saveArticle(req.body.article, req.params.id);\r\n  res.json(result);\r\n});\r\n\r\nrouter.delete('/:id', isQp, async (req: Request, res: Response) => {\r\n  const result = await deleteArticle(req.params.id);\r\n  res.json(result);\r\n});\r\n\r\nrouter.patch('/:id/state', isQp, async (req: IRequest, res: Response) => {\r\n  const result = await changeArticlePublished(req.params.id, req.body.state, req.user);\r\n  res.json(result);\r\n})\r\n\r\nexport default router;\r\n","import { Router, Request, Response } from 'express';\r\nconst router = Router();\r\nimport { isRappre, authCheck } from '@config/authcheck';\r\nimport {\r\n  getAllGadgets,\r\n  createGadget,\r\n  getAllPhotos,\r\n  createPhoto,\r\n  findProduct,\r\n  deleteProduct\r\n} from '@controllers/product';\r\n\r\n// Get all gadgets\r\nrouter.get('/gadgets', authCheck, async (req: Request, res: Response) => {\r\n  const result = await getAllGadgets();\r\n  res.json(result);\r\n});\r\n\r\n// Create a new gadget\r\nrouter.post('/create-gadgets', isRappre, async (req: Request, res: Response) => {\r\n  const result = await createGadget(req.body);\r\n  res.json(result);\r\n});\r\n\r\n// Get all photo products\r\nrouter.get('/photos', authCheck, async (req: Request, res: Response) => {\r\n  const result = await getAllPhotos();\r\n  res.json(result);\r\n});\r\n\r\n// Create a new photo product\r\nrouter.post('/create-photos', isRappre, async (req: Request, res: Response) => {\r\n  const result = await createPhoto(req.body);\r\n  res.json(result);\r\n});\r\n\r\n// Find a product via its ID\r\nrouter.post('/find', authCheck, async (req: Request, res: Response) => {\r\n  const result = await findProduct(req.body.id);\r\n  res.json(result);\r\n});\r\n\r\n// Delete a product\r\nrouter.delete('/:id', isRappre, async (req: Request, res: Response) => {\r\n  const id = req.params.id;\r\n  const result = await deleteProduct(id);\r\n  \r\n  res.json(result);\r\n})\r\n\r\nexport default router;\r\n","// Main imports\r\nimport { Response, Router } from 'express';\r\nconst router = Router();\r\nimport { IRequest } from '@csl/shared';\r\nimport { authCheck, isRappreDiClasse } from '@config/authcheck';\r\nimport {\r\n  getAllOrders,\r\n  confirmOrder,\r\n  deleteFromCart,\r\n  addToCart,\r\n} from '@controllers/order';\r\nimport { getStripeID } from '@controllers/user';\r\nimport {\r\n  updateTotal,\r\n  verifyReady,\r\n  verifyPaid,\r\n  getTotal,\r\n} from '@controllers/classe';\r\n\r\n// Stripe initialization\r\nimport { environment as env } from '@environments/environment';\r\nimport Stripe from 'stripe';\r\nconst stripe = new Stripe(env.STRIPE_KEY, {\r\n  apiVersion: '2020-08-27',\r\n  typescript: true,\r\n});\r\n\r\n// Get all orders of a user\r\nrouter.get('/', authCheck, async (req: IRequest, res: Response) => {\r\n  const response = await getAllOrders(req.user.id);\r\n\r\n  res.json(response);\r\n});\r\n\r\n// Add a product to the cart\r\nrouter.post('/add', authCheck, async (req: IRequest, res: Response) => {\r\n  const result = await addToCart(req.body.product, req.user);\r\n\r\n  res.json(result);\r\n});\r\n\r\n// Confirm an order\r\nrouter.post('/confirm', authCheck, async (req: IRequest, res: Response) => {\r\n  const orderTotal = await confirmOrder(req.user.id, req.body.category);\r\n\r\n  const classTotal = await getTotal(req.user.classID, req.body.category);\r\n\r\n  const result = await updateTotal(\r\n    orderTotal,\r\n    classTotal,\r\n    req.body.category,\r\n    req.user.classID\r\n  );\r\n\r\n  res.json(result);\r\n});\r\n\r\n// Delete an order\r\nrouter.post('/delete', authCheck, async (req: IRequest, res: Response) => {\r\n  const result = await deleteFromCart(req.user.id, req.body.product);\r\n\r\n  res.json(result);\r\n});\r\n\r\n// Create a payment intent\r\nrouter.post(\r\n  '/create-payment-intent',\r\n  isRappreDiClasse,\r\n  async (req: IRequest, res: Response) => {\r\n    const classID = req.user.classID;\r\n\r\n    const amount = await getTotal(classID, req.body.category);\r\n\r\n    if (amount < 1) {\r\n      return res.json({\r\n        success: false,\r\n        err: 'no-orders',\r\n      });\r\n    }\r\n\r\n    const stripeID = await getStripeID(req.user.id);\r\n\r\n    const isConfirmed = await verifyReady(classID, req.body.category);\r\n\r\n    if (!isConfirmed) {\r\n      return res.json({\r\n        success: false,\r\n        data: {\r\n          isConfirmed: false,\r\n        },\r\n      });\r\n    }\r\n\r\n    const isPaid = await verifyPaid(classID, req.body.category);\r\n\r\n    if (isPaid === true) {\r\n      return res.json({\r\n        success: false,\r\n        data: {\r\n          isPaid: true,\r\n        },\r\n      });\r\n    }\r\n\r\n    const paymentIntent = await stripe.paymentIntents.create({\r\n      amount,\r\n      currency: 'eur',\r\n      description: `Pagamento di ${\r\n        amount / 100\r\n      } per la classe ${classID} nella categoria ${req.body.category}`,\r\n      receipt_email: req.user.email,\r\n      customer: stripeID,\r\n      metadata: {\r\n        Classe: classID,\r\n        Categoria: req.body.category,\r\n      },\r\n    });\r\n\r\n    if (!isPaid && isConfirmed) {\r\n      return res.json({\r\n        success: true,\r\n        data: {\r\n          clientSecret: paymentIntent.client_secret,\r\n          total: amount / 100,\r\n          classID: classID,\r\n        },\r\n      });\r\n    }\r\n  }\r\n);\r\n\r\nexport default router;\r\n","import { Router, Response } from 'express';\r\nimport { IRequest } from '@csl/shared';\r\nimport { isAdmin } from '@config/authcheck';\r\nimport { getReports, reportBug, toggleSolved } from '@controllers/report';\r\nconst router = Router();\r\n\r\nrouter.get('/', isAdmin, async (req: IRequest, res: Response) => {\r\n  const result = await getReports();\r\n  res.json(result);\r\n});\r\n\r\nrouter.patch('/solved', isAdmin, async (req: IRequest, res: Response) => {\r\n  const result = await toggleSolved(req.body.id, req.body.solved);\r\n  res.json(result);\r\n});\r\n\r\nrouter.post('/bug', async (req: IRequest, res: Response) => {\r\n  const result = await reportBug(req.user || req.body.contactInfo, req.body.bugData);\r\n  res.json(result);\r\n});\r\n\r\nexport default router;\r\n","import { Router, Request, Response } from 'express';\r\nconst router = Router();\r\nimport { isBar, authCheck } from '@config/authcheck';\r\nimport {\r\n  createSnack,\r\n  deleteSnack,\r\n  updateMaxQuantity,\r\n  getSnacks,\r\n} from '@controllers/snack';\r\nimport {\r\n  addSnackToCart,\r\n  getSnacksCart,\r\n  deleteSnackFromCart,\r\n  confirmSnackOrder,\r\n} from '@controllers/snack-order';\r\n\r\nrouter.get('/', authCheck, async (req: Request, res: Response) => {\r\n  const result = await getSnacks();\r\n\r\n  res.json(result);\r\n});\r\n\r\nrouter.get('/cart', authCheck, async (req: Request, res: Response) => {\r\n  const user: any = req.user!;\r\n\r\n  const result = await getSnacksCart(user.id);\r\n\r\n  res.json(result);\r\n});\r\n\r\nrouter.post('/cart', authCheck, async (req: Request, res: Response) => {\r\n  const user: any = req.user!;\r\n\r\n  const result = await addSnackToCart(req.body.id, user);\r\n\r\n  res.json(result);\r\n});\r\n\r\nrouter.delete('/cart/:id', authCheck, async (req: Request, res: Response) => {\r\n  const user: any = req.user!;\r\n\r\n  const result = await deleteSnackFromCart(req.params.id, user.id);\r\n\r\n  res.json(result);\r\n});\r\n\r\nrouter.get('/cart/confirm', authCheck, async (req: Request, res: Response) => {\r\n  const user: any = req.user!;\r\n\r\n  const result = await confirmSnackOrder(user);\r\n\r\n  res.json(result);\r\n});\r\n\r\nrouter.post('/manage', isBar, async (req: Request, res: Response) => {\r\n  const result = await createSnack(req.body.snack);\r\n\r\n  res.json(result);\r\n});\r\n\r\nrouter.delete('/manage/:id', isBar, async (req: Request, res: Response) => {\r\n  const result = await deleteSnack(req.params.id);\r\n\r\n  res.json(result);\r\n});\r\n\r\nrouter.patch('/manage/:id', isBar, async (req: Request, res: Response) => {\r\n  const result = await updateMaxQuantity(req.body.maxQuantity, req.params.id);\r\n\r\n  res.json(result);\r\n});\r\n\r\nexport default router;\r\n","import { Response, Router } from 'express';\r\nimport { IRequest } from '@csl/shared';\r\nconst router = Router();\r\nimport { createCourse, getCourses } from '@controllers/course';\r\nimport { authCheck } from '@config/authcheck';\r\n\r\nrouter.get('/courses', authCheck, async (req: IRequest, res: Response) => {\r\n  const result = await getCourses(req.user);\r\n\r\n  res.json(result);\r\n})\r\n\r\nrouter.post('/courses', authCheck, async (req: IRequest, res: Response) => {\r\n  const result = await createCourse(req.body.course, req.user);\r\n\r\n  res.json(result);\r\n})\r\n\r\nexport default router;\r\n","import { Router, Response } from 'express';\r\nconst router = Router();\r\n\r\nimport { authCheck, isReferente } from '@config/authcheck';\r\nimport { ICommissione, IRequest } from '@csl/shared';\r\nimport { getCommissione, setPage } from '@controllers/commissione';\r\nimport { bucket } from '@config/firebase';\r\nimport { UploadedFile } from 'express-fileupload';\r\nimport fse from 'fs-extra';\r\nimport { join } from 'path';\r\nimport { tmpdir } from 'os';\r\n\r\nrouter.get('/:id', async (req: IRequest, res: Response) => {\r\n  const params: any = req.params;\r\n  const id: ICommissione['id'] = params.id;\r\n  const result = await getCommissione(id);\r\n\r\n  res.json(result);\r\n})\r\n\r\nrouter.patch('/:id', isReferente, async (req: IRequest, res: Response) => {\r\n  const params: any = req.params;\r\n  const id: ICommissione['id'] = params.id;\r\n  const result = await setPage(id, req.body.page, req.user);\r\n\r\n  res.json(result);\r\n})\r\n\r\n// Images\r\nrouter.post('/image', isReferente, async (req: IRequest, res: Response) => {\r\n  const files: any = req.files;\r\n  const image: UploadedFile = files.image;\r\n  const fileName = `${Date.now()}_${image.name}`;\r\n  const workingDir = join(tmpdir(), 'commissioni');\r\n  const tmpFilePath = join(workingDir, fileName);\r\n  const firebasePath = `commissioni/images/${fileName}`;\r\n  await fse.emptyDir(workingDir);\r\n\r\n  await image.mv(tmpFilePath);\r\n\r\n  await bucket.upload(tmpFilePath, {\r\n    destination: firebasePath,\r\n  });\r\n\r\n  res.json({\r\n    success: '1',\r\n    file: {\r\n      url: `/api/commissioni/image/${fileName}`,\r\n      firebasePath,\r\n    },\r\n  });\r\n});\r\n\r\nrouter.get(\r\n  '/image/:fileName',\r\n  async (req: IRequest, res: Response) => {\r\n    const firebasePath = `commissioni/images/${req.params.fileName}`;\r\n\r\n    const workingDir = join(tmpdir(), 'commissioni');\r\n    const tmpFilePath = join(workingDir, req.params.fileName);\r\n    await fse.emptyDir(workingDir);\r\n\r\n    await bucket.file(firebasePath).download({\r\n      destination: tmpFilePath,\r\n    });\r\n\r\n    res.sendFile(tmpFilePath);\r\n  }\r\n);\r\n\r\nexport default router;\r\n","// Main imports\r\nimport * as express from 'express';\r\nimport { environment as env } from '@environments/environment';\r\nimport * as cors from 'cors';\r\nimport * as path from 'path';\r\nimport * as mongoose from 'mongoose';\r\nimport * as passport from 'passport';\r\nimport * as fileUpload from 'express-fileupload';\r\nimport cookieSession from 'cookie-session';\r\nimport { webhookHandler } from '@config/webhook';\r\nimport * as http from 'http';\r\nimport * as io from 'socket.io';\r\n\r\nimport '@config/passport';\r\nimport { socketConfig } from '@config/socket';\r\n\r\n// Routes\r\nimport admin from '@routes/admin';\r\nimport auth from '@routes/auth';\r\nimport upload from '@routes/upload';\r\nimport users from '@routes/users';\r\nimport articles from '@routes/articles';\r\nimport products from '@routes/products';\r\nimport orders from '@routes/orders';\r\nimport reports from '@routes/reports';\r\nimport snacks from '@routes/snacks';\r\nimport coge from '@routes/coge';\r\nimport commissioni from '@routes/commissioni';\r\nimport { saveError } from '@config/winston';\r\n\r\n// Connect to database\r\nmongoose.connect(env.DB_URI, {\r\n  // Avoid deprecation warning\r\n  useNewUrlParser: true,\r\n  useUnifiedTopology: true,\r\n  useFindAndModify: false,\r\n  useCreateIndex: true,\r\n});\r\n\r\nmongoose.connection.on('connected', () => {\r\n  console.log(`Connected to database: ${env.DB_URI}`);\r\n});\r\n\r\nmongoose.connection.on('error', (err: any) => {\r\n  console.log(`Database error: ${err}`);\r\n});\r\n\r\n// Declare Express app\r\nconst app = express();\r\n\r\n// Cookie session middleware\r\napp.use(\r\n  cookieSession({\r\n    maxAge: 24 * 60 * 60 * 1000,\r\n    keys: env.COOKIE_KEYS,\r\n  })\r\n);\r\n\r\n// CORS middleware\r\napp.use(cors());\r\n\r\n// Initialize passport\r\napp.use(passport.initialize());\r\napp.use(passport.session());\r\n\r\n// Receive webhooks from Stripe\r\napp.post(\r\n  '/api/webhook',\r\n  express.raw({ type: 'application/json' }),\r\n  webhookHandler\r\n);\r\n\r\n// Read JSON requests\r\napp.use(express.json());\r\n\r\n// Enable file upload\r\napp.use(\r\n  fileUpload({\r\n    createParentPath: true,\r\n  })\r\n);\r\n\r\n// Routes\r\napp.use('/api/admin', admin);\r\napp.use('/api/auth', auth);\r\napp.use('/api/upload', upload);\r\napp.use('/api/users', users);\r\napp.use('/api/articles', articles);\r\napp.use('/api/products', products);\r\napp.use('/api/orders', orders);\r\napp.use('/api/reports', reports);\r\napp.use('/api/snacks', snacks);\r\napp.use('/api/coge', coge);\r\napp.use('/api/commissioni', commissioni);\r\n\r\n// Static folder\r\napp.use(express.static(path.join(__dirname, 'public')));\r\napp.use('*', (req: any, res: any) => {\r\n  res.sendFile(path.join(__dirname, 'public', 'index.html'));\r\n});\r\n\r\n// Start server and socket\r\nconst port = env.PORT;\r\nconst server = http.createServer(app);\r\nconst socket = io(server, { path: '/api/socket' });\r\n\r\nsocketConfig(socket);\r\n\r\nserver.listen(port, () => {\r\n  console.log(`Server started on port ${port}`);\r\n});\r\n\r\nprocess.on('unhandledRejection', (err) => {\r\n  saveError('UnhandledRejection occurred, check db for more details', {\r\n    category: 'server',\r\n    err,\r\n  });\r\n});\r\n\r\nprocess.on('uncaughtException', (err) => {\r\n  saveError('UnhandledException occurred, check db for more details', {\r\n    category: 'server',\r\n    err,\r\n  });\r\n});\r\n","import passport from 'passport';\r\nimport { environment as env } from '@environments/environment';\r\nconst GoogleStrategy = require('passport-google-oauth').OAuth2Strategy;\r\nimport { User } from '@controllers/user';\r\n\r\n// Create user session\r\npassport.serializeUser((user: any, done: any) => {\r\n  done(null, user.id);\r\n});\r\n\r\n// Decrypt session and find user\r\npassport.deserializeUser((id, done) => {\r\n  User.findOne({ id: id }).then((user) => {\r\n    done(null, user);\r\n  });\r\n});\r\n\r\n// Google Login\r\npassport.use(\r\n  new GoogleStrategy(\r\n    {\r\n      clientID: env.GOOGLE_CLIENT_ID,\r\n      clientSecret: env.GOOGLE_CLIENT_SECRET,\r\n      callbackURL: '/api/auth/redirect',\r\n    },\r\n    (accessToken: any, refreshToken: any, profile: any, done: any) => {\r\n      const id = profile.id;\r\n      const photoURL = profile.photos[0].value;\r\n      const email = profile.emails[0].value;\r\n\r\n      User.findOne({ id }).then(async (user) => {\r\n        if (user) {\r\n          await user.updateOne({ photoURL });\r\n\r\n          done(null, user);\r\n        } else {\r\n          User.findOne({ email }).then(async (user) => {\r\n            if (user) {\r\n              await user.updateOne({\r\n                id,\r\n                photoURL,\r\n              });\r\n\r\n              User.findOne({ id }).then((user) => {\r\n                done(null, user);\r\n              });\r\n            } else {\r\n              done(null, null);\r\n            }\r\n          });\r\n        }\r\n      });\r\n    }\r\n  )\r\n);\r\n","module.exports = require(\"passport-google-oauth\");"],"sourceRoot":""}