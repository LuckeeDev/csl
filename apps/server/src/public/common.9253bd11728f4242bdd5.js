(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{CAI7:function(e,i,t){"use strict";t.d(i,"a",(function(){return G}));var a=t("DY2v"),o=t("+IuD"),s=t.n(o),n=t("w/LV"),c=t.n(n),l=t("6V5p"),r=t.n(l),m=t("UIvY"),b=t.n(m),d=t("eVdK"),u=t.n(d),h=t("pkNS"),p=t.n(h),g=t("jxfh"),f=t("9ufM"),w=t("YtkY"),v=t("TLy2"),k=t("EM62"),C=t("sEIs"),D=t("2gE8"),P=t("Meci"),T=t("2kYt"),y=t("PBFl"),S=t("FlRo");function V(e,i){1&e&&(k.Vb(0,"mat-header-cell"),k.Gc(1,"File"),k.Ub())}function E(e,i){if(1&e&&(k.Vb(0,"mat-cell"),k.Gc(1),k.Ub()),2&e){const e=i.$implicit,t=k.gc(2);k.Db(1),k.Hc(t.getDisplayName(e))}}function U(e,i){1&e&&(k.Vb(0,"mat-header-cell"),k.Gc(1,"Gestisci"),k.Ub())}function I(e,i){if(1&e){const e=k.Wb();k.Vb(0,"mat-cell"),k.Vb(1,"button",15),k.cc("click",(function(){k.vc(e);const t=i.$implicit;return k.gc(2).deletePDF(t)})),k.Gc(2," Elimina "),k.Ub(),k.Ub()}}function F(e,i){1&e&&k.Qb(0,"mat-header-row")}function L(e,i){1&e&&k.Qb(0,"mat-row")}function R(e,i){if(1&e&&(k.Vb(0,"mat-table",8),k.Tb(1,9),k.Ec(2,V,2,0,"mat-header-cell",10),k.Ec(3,E,2,1,"mat-cell",11),k.Sb(),k.Tb(4,12),k.Ec(5,U,2,0,"mat-header-cell",10),k.Ec(6,I,3,0,"mat-cell",11),k.Sb(),k.Ec(7,F,1,0,"mat-header-row",13),k.Ec(8,L,1,0,"mat-row",14),k.Ub()),2&e){const e=k.gc();k.mc("dataSource",e.commissione.files),k.Db(7),k.mc("matHeaderRowDef",e.displayedColumns),k.Db(1),k.mc("matRowDefColumns",e.displayedColumns)}}let G=(()=>{class e{constructor(e,i,t,a,o,s){this.commissioni=e,this.dialog=i,this.toastr=t,this.auth=a,this.router=o,this.afs=s,this.displayedColumns=["name","manage"]}getDisplayName(e){const i=e.split("_");return i.shift(),i.join("_")}ngOnInit(){}ngAfterViewInit(){this.auth.user$.pipe(Object(w.a)((e=>this.router.url.includes("rappre")&&e.isRappre?"comitato":this.router.url.includes("referente")?e.isReferente:void 0)),Object(v.a)((e=>this.commissioni.getPage(e)))).subscribe((e=>{this.commissione=e.data,this.editor=new s.a({holder:"editorjs",data:this.commissione.page?this.commissione.page:null,tools:{header:{class:c.a,shortcut:"CTRL+ALT+T",inlineToolbar:["bold","italic","hyperlink"],config:{placeholder:"Titolo",levels:[1,2,3],defaultLevel:1}},paragraph:{class:r.a,shortcut:"CTRL+ALT+Q",inlineToolbar:["bold","italic","hyperlink"],config:{placeholder:"Testo"}},list:{class:b.a,shortcut:"CTRL+ALT+W",inlineToolbar:["bold","italic","hyperlink"]},image:{class:u.a,shortcut:"CTRL+ALT+I",inlineToolbar:["bold","italic","hyperlink"],config:{endpoints:{byFile:`/api/commissioni/${this.commissione.id}/image`}}},hyperlink:{class:p.a,config:{availableTargets:["_blank","_self"],availableRels:["external"],target:"_blank",rel:"external"}}},defaultBlock:"paragraph",i18n:{messages:{toolNames:{Text:"Paragrafo",Heading:"Titolo",List:"Elenco",Image:"Immagine",Bold:"Grassetto",Italic:"Corsivo",Hyperlink:"Link"},tools:{list:{Ordered:"Numerato",Unordered:"Non numerato"},image:{"Select an Image":"Carica un'immagine","With border":"Con bordo","Stretch image":"Allarga immagine","With background":"Con sfondo"},link:{"Add a link":"Aggiungi un link"},hyperlink:{Save:"Salva","Select target":"Seleziona destinazione","Select rel":"Seleziona relazione"}},blockTunes:{delete:{Delete:"Elimina"},moveUp:{"Move up":"Sposta su"},moveDown:{"Move down":"Sposta gi\xf9"}},ui:{blockTunes:{toggler:{"Click to tune":"Modifica"}},inlineToolbar:{converter:{"Convert to":"Converti in"}},toolbar:{toolbox:{Add:"Aggiungi"}}}}},autofocus:!0})}))}uploadPDF(e){const i=e.target.files[0],t=`${Date.now()}_${i.name}`;this.afs.ref(`commissioni/${this.commissione.id}/pdf/${t}`).put(i).then((()=>{this.commissioni.addPDF(t,this.commissione.id).subscribe((e=>{e.success?(this.commissione.files=e.data,this.toastr.show({color:"basic",message:"PDF caricato con successo"})):this.toastr.showError()}))})).catch((()=>{this.toastr.showError()}))}deletePDF(e){this.dialog.open({title:"Eliminare il file?",text:"Questa azione non potr\xe0 pi\xf9 essere annullata",answer:"S\xec, elimina",color:"warn"}).pipe(Object(v.a)((()=>this.commissioni.removePDF(e,this.commissione.id)))).subscribe((e=>{e.success?(this.commissione.files=e.data,this.toastr.show({color:"basic",message:"File rimosso con successo"})):this.toastr.showError()}))}save(){this.dialog.open({title:"Salvare pagina?",text:"Potrai tornare quando vorrai per modificarla",answer:"Salva",color:"primary"}).subscribe((()=>{this.editor.save().then((e=>{this.commissioni.savePage(this.commissione.id,e).subscribe((e=>{e.success?this.toastr.show({color:"success",message:"Pagina salvata"}):this.toastr.showError()}))}))}))}}return e.\u0275fac=function(i){return new(i||e)(k.Pb(a.a),k.Pb(g.a),k.Pb(g.b),k.Pb(f.a),k.Pb(C.g),k.Pb(D.a))},e.\u0275cmp=k.Jb({type:e,selectors:[["csl-editor"]],decls:16,vars:1,consts:[["id","editorjs"],[1,"header"],["class","table",3,"dataSource",4,"ngIf"],[1,"actions"],["type","file","accept","application/pdf",2,"display","none",3,"change"],["fileInput",""],["mat-raised-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"],[1,"table",3,"dataSource"],["matColumnDef","name"],[4,"matHeaderCellDef"],[4,"matCellDef"],["matColumnDef","manage"],[4,"matHeaderRowDef"],[4,"matRowDef","matRowDefColumns"],["mat-stroked-button","","color","warn",3,"click"]],template:function(e,i){if(1&e){const e=k.Wb();k.Vb(0,"mat-card"),k.Vb(1,"mat-card-header"),k.Vb(2,"mat-card-title"),k.Gc(3,"Gestisci la pagina della tua Commissione"),k.Ub(),k.Ub(),k.Vb(4,"mat-card-content"),k.Qb(5,"div",0),k.Vb(6,"h2",1),k.Gc(7,"Gestisci i file della tua Commissione"),k.Ub(),k.Ec(8,R,9,3,"mat-table",2),k.Ub(),k.Vb(9,"mat-card-actions",3),k.Vb(10,"input",4,5),k.cc("change",(function(e){return i.uploadPDF(e)})),k.Ub(),k.Vb(12,"button",6),k.cc("click",(function(){return k.vc(e),k.sc(11).click()})),k.Gc(13," Carica file PDF "),k.Ub(),k.Vb(14,"button",7),k.cc("click",(function(){return i.save()})),k.Gc(15," Salva pagina "),k.Ub(),k.Ub(),k.Ub()}2&e&&(k.Db(8),k.mc("ngIf",i.commissione))},directives:[P.a,P.e,P.h,P.d,T.m,P.b,y.b,S.j,S.c,S.e,S.b,S.g,S.i,S.d,S.a,S.f,S.h],styles:[".actions[_ngcontent-%COMP%]{margin-top:10px}.actions[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]{margin-left:20px}.table[_ngcontent-%COMP%]{width:100%}.header[_ngcontent-%COMP%]{margin-left:20px}"]}),e})()}}]);