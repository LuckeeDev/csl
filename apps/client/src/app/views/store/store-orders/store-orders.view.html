<mat-card>
	<mat-card-header>
		<mat-card-title class="title">
			Ordini {{ category | category }} -
			<ng-container *ngIf="total$ | async as total; else noTotal">
				{{ total.value / 100 | currency: 'EUR' }}
			</ng-container>

			<ng-template #noTotal>
				<span>
					<mat-spinner [diameter]="20"></mat-spinner>
				</span>
			</ng-template>
		</mat-card-title>
	</mat-card-header>

	<mat-card-content *ngIf="user$ | async as user">
		<table mat-table [dataSource]="orders$ | async">
			<ng-container matColumnDef="name">
				<th mat-header-cell *matHeaderCellDef>Nome</th>
				<td mat-cell *matCellDef="let product">{{ product.name }}</td>
			</ng-container>

			<ng-container matColumnDef="quantity">
				<th mat-header-cell *matHeaderCellDef>Quantit√†</th>
				<td mat-cell *matCellDef="let product">{{ product.quantity }}</td>
			</ng-container>

			<ng-container matColumnDef="size">
				<th mat-header-cell *matHeaderCellDef>Taglia</th>
				<td mat-cell *matCellDef="let product">{{ product.size }}</td>
			</ng-container>

			<ng-container matColumnDef="color">
				<th mat-header-cell *matHeaderCellDef>Colore</th>
				<td mat-cell *matCellDef="let product">
					<span [ngStyle]="{ 'background-color': product.color }"></span>
				</td>
			</ng-container>

			<ng-container matColumnDef="price">
				<th mat-header-cell *matHeaderCellDef>Prezzo</th>
				<td mat-cell *matCellDef="let product">
					{{ product.quantity * product.price / 100 | currency: 'EUR' }}
				</td>
			</ng-container>

			<ng-container matColumnDef="actions">
				<th mat-header-cell *matHeaderCellDef>Gestisci</th>
				<td mat-cell *matCellDef="let product">
					<button
						mat-stroked-button
						color="warn"
						(click)="removeFromCart(product)"
						[disabled]="user.confirmed && user.confirmed[category]"
						*ngIf="!product.discounted"
					>
						Rimuovi
					</button>
				</td>
			</ng-container>

			<tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
			<tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
		</table>
	</mat-card-content>

	<mat-card-actions *ngIf="user$ | async as user">
		<ng-container *ngIf="orders$ | async as orders">
			<ng-container *ngIf="orders.length === 0">
				<p>Nessun ordine in questa categoria!</p>
			</ng-container>

			<ng-container
				*ngIf="(!user.confirmed || !user.confirmed[category]) && !(orders.length === 0)"
			>
				<button
					mat-raised-button
					color="primary"
					size="small"
					(click)="confirmOrder()"
				>
					Conferma ordine
				</button>
			</ng-container>

			<ng-container *ngIf="user.confirmed && user.confirmed[category]">
				<p>Ordine confermato!</p>
			</ng-container>
		</ng-container>
	</mat-card-actions>
</mat-card>
