<form [formGroup]="productForm" (ngSubmit)="onSubmit()" class="container">
	<h4>Informazioni principali</h4>

	<mat-form-field class="textinput">
		<mat-label>Nome del prodotto</mat-label>
		<input matInput type="text" formControlName="name" />
		<mat-hint align="start">
			<strong>Assicurati di non aver mai usato questo nome</strong>
		</mat-hint>
	</mat-form-field>

	<mat-form-field class="textinput">
		<mat-label>Descrizione del prodotto</mat-label>
		<input matInput type="text" formControlName="description" />
	</mat-form-field>

	<mat-form-field class="textinput">
		<mat-label>Prezzo</mat-label>
		<span matPrefix>â‚¬</span>
		<input matInput type="number" formControlName="price" />
	</mat-form-field>

	<h4>Sconto</h4>

	<mat-checkbox formControlName="discountable" color="primary">
		Sconto {{ productForm.value.discountable ? 'attivato': 'disattivato'}}
	</mat-checkbox>

	<ng-container formGroupName="sizes" *ngIf="category === 'gadgets'">
		<br />

		<h4>Taglie disponibili</h4>

		<div class="checkboxes">
			<mat-checkbox
				*ngFor="let size of sizes"
				color="primary"
				formControlName="{{ size }}"
			>
				{{ size }}
			</mat-checkbox>
		</div>
	</ng-container>

	<ng-container formArrayName="colors" *ngIf="category === 'gadgets'">
		<br />

		<h4>Colori disponibili</h4>

		<button
			mat-stroked-button
			type="button"
			color="primary"
			(click)="addColor()"
			class="btn"
		>
			Aggiungi un colore
		</button>

		<div class="break"></div>

		<div
			*ngFor="let color of colors.controls; let i = index"
			[formGroupName]="i"
			class="color-container"
		>
			<mat-form-field appearance="fill" class="field">
				<mat-label class="label">Colore</mat-label>
				<input matInput type="color" class="input" formControlName="color" />
			</mat-form-field>

			<mat-form-field appearance="fill" class="field">
				<mat-label class="label">ID</mat-label>
				<input matInput type="text" formControlName="id" class="input" />
			</mat-form-field>

			<button
				mat-icon-button
				color="warn"
				type="button"
				class="deleteColor"
				(click)="removeColor(i)"
			>
				<mat-icon>close</mat-icon>
			</button>
		</div>
	</ng-container>

	<br />

	<h4>Immagini</h4>
	<input
		type="file"
		multiple="true"
		formControlName="files"
		style="display: none"
		#uploadFiles
		(change)="products.onImgSelect($event)"
	/>

	<button
		mat-stroked-button
		type="button"
		color="primary"
		size="small"
		(click)="uploadFiles.click()"
		class="btn"
	>
		Carica
	</button>

	<div class="break"></div>

	<mat-card>
		<mat-card-header>
			<mat-card-title> Riepilogo </mat-card-title>
		</mat-card-header>
		<mat-card-content>
			<table class="table">
				<tr>
					<th>Nome:</th>
					<td>{{ productForm.value.name }}</td>
				</tr>
				<tr>
					<th>Descrizione:</th>
					<td>{{ productForm.value.description }}</td>
				</tr>
				<tr>
					<th>Prezzo:</th>
					<td>{{ productForm.value.price | currency: 'EUR' }}</td>
				</tr>
				<tr *ngIf="category === 'gadgets'">
					<th>Taglie:</th>
					<td>{{ selectedSizesString }}</td>
				</tr>
				<tr *ngIf="category === 'gadgets'">
					<th>Colori:</th>
					<td>
						<span
							*ngFor="let color of productForm.value.colors"
							[ngStyle]="{ 'background-color': color.color }"
							class="color"
						></span>
					</td>
				</tr>
				<tr>
					<th>Immagini:</th>
					<td>{{ uploadedImagesString }}</td>
				</tr>
			</table>
		</mat-card-content>
	</mat-card>

	<button
		mat-raised-button
		type="submit"
		color="primary"
		[disabled]="!productForm.valid || (loading$ | async)"
	>
		<span>
			<mat-spinner
				class="spinner"
				*ngIf="loading$ | async"
				[diameter]="20"
			></mat-spinner>
			Crea prodotto
		</span>
	</button>
</form>
